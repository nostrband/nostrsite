var ZapThreads=function(){"use strict";var e=Object.defineProperty,t=(t,n,r)=>(((t,n,r)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r})(t,"symbol"!=typeof n?n+"":n,r),r);const n=Symbol("solid-proxy"),r=Symbol("solid-track"),o={equals:(e,t)=>e===t};let i=R;const s=1,a=2,l={owned:null,cleanups:null,context:null,owner:null},c={};var u=null;let d,h=null,f=null,p=null,g=null,y=0;function m(e,t){const n=f,r=u,o=0===e.length,i=void 0===t?r:t,s=o?l:{owned:null,cleanups:null,context:i?i.context:null,owner:i},a=o?e:()=>e((()=>S((()=>H(s)))));u=s,f=null;try{return P(a,!0)}finally{f=n,u=r}}function w(e,t){const n={value:e,observers:null,observerSlots:null,comparator:(t=t?Object.assign({},o,t):o).equals||void 0};return[C.bind(n),e=>("function"==typeof e&&(e=e(n.value)),O(n,e))]}function b(e,t,n){L(B(e,t,!0,s))}function v(e,t,n){L(B(e,t,!1,s))}function E(e,t,n){i=U;const r=B(e,t,!1,s),o=d&&function(e){let t;return u&&u.context&&void 0!==(t=u.context[e.id])?t:e.defaultValue}(d);o&&(r.suspense=o),n&&n.render||(r.user=!0),g?g.push(r):L(r)}function x(e,t,n){n=n?Object.assign({},o,n):o;const r=B(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,L(r),C.bind(r)}function k(e,t,n){let r,o,i;2===arguments.length&&"object"==typeof t||1===arguments.length?(r=!0,o=e,i=t||{}):(r=e,o=t,i=n||{});let s=null,a=c,l=!1,u="initialValue"in i,h="function"==typeof r&&x(r);const p=new Set,[g,y]=(i.storage||w)(i.initialValue),[m,v]=w(void 0),[E,k]=w(void 0,{equals:!1}),[A,z]=w(u?"ready":"unresolved");function T(e,t,n,r){return s===e&&(s=null,void 0!==r&&(u=!0),e!==a&&t!==a||!i.onHydrated||queueMicrotask((()=>i.onHydrated(r,{value:t}))),a=c,function(e,t){P((()=>{void 0===t&&y((()=>e)),z(void 0!==t?"errored":u?"ready":"unresolved"),v(t);for(const e of p.keys())e.decrement();p.clear()}),!1)}(t,n)),t}function I(){const e=d,t=g(),n=m();if(void 0!==n&&!s)throw n;return f&&!f.user&&e&&b((()=>{E(),s&&(e.resolved||p.has(e)||(e.increment(),p.add(e)))})),t}function _(e=!0){if(!1!==e&&l)return;l=!1;const t=h?h():r;if(null==t||!1===t)return void T(s,S(g));const n=a!==c?a:S((()=>o(t,{value:g(),refetching:e})));return(i=n)&&"object"==typeof i&&"then"in i?(s=n,"value"in n?("success"===n.status?T(s,n.value,void 0,t):T(s,void 0,M(n.value),t),n):(l=!0,queueMicrotask((()=>l=!1)),P((()=>{z(u?"refreshing":"pending"),k()}),!1),n.then((e=>T(n,e,void 0,t)),(e=>T(n,void 0,M(e),t))))):(T(s,n,void 0,t),n);var i}return Object.defineProperties(I,{state:{get:()=>A()},error:{get:()=>m()},loading:{get(){const e=A();return"pending"===e||"refreshing"===e}},latest:{get(){if(!u)return I();const e=m();if(e&&!s)throw e;return g()}}}),h?b((()=>_(!1))):_(!1),[I,{refetch:_,mutate:y}]}function A(e){return P(e,!1)}function S(e){if(null===f)return e();const t=f;f=null;try{return e()}finally{f=t}}function z(e,t,n){const r=Array.isArray(e);let o,i=n&&n.defer;return n=>{let s;if(r){s=Array(e.length);for(let t=0;t<e.length;t++)s[t]=e[t]()}else s=e();if(i)return i=!1,n;const a=S((()=>t(s,o,n)));return o=s,a}}function T(e){E((()=>S(e)))}function I(e){return null===u||(null===u.cleanups?u.cleanups=[e]:u.cleanups.push(e)),e}function _(){return f}function C(){if(this.sources&&this.state)if(this.state===s)L(this);else{const e=p;p=null,P((()=>N(this)),!1),p=e}if(f){const e=this.observers?this.observers.length:0;f.sources?(f.sources.push(this),f.sourceSlots.push(e)):(f.sources=[this],f.sourceSlots=[e]),this.observers?(this.observers.push(f),this.observerSlots.push(f.sources.length-1)):(this.observers=[f],this.observerSlots=[f.sources.length-1])}return this.value}function O(e,t,n){let r=e.value;return e.comparator&&e.comparator(r,t)||(e.value=t,e.observers&&e.observers.length&&P((()=>{for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t],r=h&&h.running;r&&h.disposed.has(n),(r?n.tState:n.state)||(n.pure?p.push(n):g.push(n),n.observers&&j(n)),r||(n.state=s)}if(p.length>1e6)throw p=[],new Error}),!1)),t}function L(e){if(!e.fn)return;H(e);const t=y;!function(e,t,n){let r;const o=u,i=f;f=u=e;try{r=e.fn(t)}catch(a){return e.pure&&(e.state=s,e.owned&&e.owned.forEach(H),e.owned=null),e.updatedAt=n+1,D(a)}finally{f=i,u=o}(!e.updatedAt||e.updatedAt<=n)&&(null!=e.updatedAt&&"observers"in e?O(e,r):e.value=r,e.updatedAt=n)}(e,e.value,t)}function B(e,t,n,r=s,o){const i={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:u,context:u?u.context:null,pure:n};return null===u||u!==l&&(u.owned?u.owned.push(i):u.owned=[i]),i}function $(e){if(0===e.state)return;if(e.state===a)return N(e);if(e.suspense&&S(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<y);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if((e=t[n]).state===s)L(e);else if(e.state===a){const n=p;p=null,P((()=>N(e,t[0])),!1),p=n}}function P(e,t){if(p)return e();let n=!1;t||(p=[]),g?n=!0:g=[],y++;try{const t=e();return function(e){p&&(R(p),p=null);if(e)return;const t=g;g=null,t.length&&P((()=>i(t)),!1)}(n),t}catch(r){n||(g=null),p=null,D(r)}}function R(e){for(let t=0;t<e.length;t++)$(e[t])}function U(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:$(r)}for(t=0;t<n;t++)$(e[t])}function N(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const e=r.state;e===s?r!==t&&(!r.updatedAt||r.updatedAt<y)&&$(r):e===a&&N(r,t)}}}function j(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=a,n.pure?p.push(n):g.push(n),n.observers&&j(n))}}function H(e){let t;if(e.sources)for(;e.sources.length;){const t=e.sources.pop(),n=e.sourceSlots.pop(),r=t.observers;if(r&&r.length){const e=r.pop(),o=t.observerSlots.pop();n<r.length&&(e.sourceSlots[o]=n,r[n]=e,t.observerSlots[n]=o)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)H(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)H(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function M(e){return e instanceof Error?e:new Error("string"==typeof e?e:"Unknown error",{cause:e})}function D(e,t=u){throw M(e)}const q=Symbol("fallback");function V(e){for(let t=0;t<e.length;t++)e[t]()}function F(e,t){return S((()=>e(t||{})))}function K(e){const t="fallback"in e&&{fallback:()=>e.fallback};return x(function(e,t,n={}){let o,i=[],s=[],a=[],l=[],c=0;return I((()=>V(a))),()=>{const u=e()||[],d=u.length;return u[r],S((()=>{if(0===d)return 0!==c&&(V(a),a=[],i=[],s=[],c=0,l=[]),n.fallback&&(i=[q],s[0]=m((e=>(a[0]=e,n.fallback()))),c=1),s;for(i[0]===q&&(a[0](),a=[],i=[],s=[],c=0),o=0;o<d;o++)o<i.length&&i[o]!==u[o]?l[o]((()=>u[o])):o>=i.length&&(s[o]=m(h));for(;o<i.length;o++)a[o]();return c=l.length=a.length=d,i=u.slice(0),s=s.slice(0,c)}));function h(e){a[o]=e;const[n,r]=w(u[o]);return l[o]=r,t(n,o)}}}((()=>e.each),e.children,t||void 0))}function W(e){const t=e.keyed,n=x((()=>e.when),void 0,{equals:(e,n)=>t?e===n:!e==!n});return x((()=>{const r=n();if(r){const o=e.children;return"function"==typeof o&&o.length>0?S((()=>o(t?r:()=>{if(!S(n))throw`Stale read from <${"Show"}>.`;return e.when}))):o}return e.fallback}),void 0,void 0)}const Z="_$DX_DELEGATE";function J(e,t,n){let r;const o=()=>{const t=document.createElement("template");return t.innerHTML=e,n?t.content.firstChild.firstChild:t.content.firstChild},i=t?()=>S((()=>document.importNode(r||(r=o()),!0))):()=>(r||(r=o())).cloneNode(!0);return i.cloneNode=i,i}function G(e,t=window.document){const n=t[Z]||(t[Z]=new Set);for(let r=0,o=e.length;r<o;r++){const o=e[r];n.has(o)||(n.add(o),t.addEventListener(o,ne))}}function Y(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function Q(e,t){null==t?e.removeAttribute("class"):e.className=t}function X(e,t,n){if(!t)return n?Y(e,"style"):t;const r=e.style;if("string"==typeof t)return r.cssText=t;let o,i;for(i in"string"==typeof n&&(r.cssText=n=void 0),n||(n={}),t||(t={}),n)null==t[i]&&r.removeProperty(i),delete n[i];for(i in t)o=t[i],o!==n[i]&&(r.setProperty(i,o),n[i]=o);return n}function ee(e,t,n){return S((()=>e(t,n)))}function te(e,t,n,r){if(void 0===n||r||(r=[]),"function"!=typeof t)return re(e,t,r,n);v((r=>re(e,t(),r,n)),r)}function ne(e){let t=e.target;const n=`$$${e.type}`,r=e.target,o=e.currentTarget,i=t=>Object.defineProperty(e,"target",{configurable:!0,value:t}),s=()=>{const r=t[n];if(r&&!t.disabled){const o=t[`${n}Data`];if(void 0!==o?r.call(t,o,e):r.call(t,e),e.cancelBubble)return}return t.host&&"string"!=typeof t.host&&!t.host._$host&&t.contains(e.target)&&i(t.host),!0},a=()=>{for(;s()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get:()=>t||document}),e.composedPath){const n=e.composedPath();i(n[0]);for(let e=0;e<n.length-2&&(t=n[e],s());e++){if(t._$host){t=t._$host,a();break}if(t.parentNode===o)break}}else a();i(r)}function re(e,t,n,r,o){for(;"function"==typeof n;)n=n();if(t===n)return n;const i=typeof t,s=void 0!==r;if(e=s&&n[0]&&n[0].parentNode||e,"string"===i||"number"===i){if("number"===i&&(t=t.toString())===n)return n;if(s){let o=n[0];o&&3===o.nodeType?o.data!==t&&(o.data=t):o=document.createTextNode(t),n=se(e,n,r,o)}else n=""!==n&&"string"==typeof n?e.firstChild.data=t:e.textContent=t}else if(null==t||"boolean"===i)n=se(e,n,r);else{if("function"===i)return v((()=>{let o=t();for(;"function"==typeof o;)o=o();n=re(e,o,n,r)})),()=>n;if(Array.isArray(t)){const i=[],a=n&&Array.isArray(n);if(oe(i,t,n,o))return v((()=>n=re(e,i,n,r,!0))),()=>n;if(0===i.length){if(n=se(e,n,r),s)return n}else a?0===n.length?ie(e,i,r):function(e,t,n){let r=n.length,o=t.length,i=r,s=0,a=0,l=t[o-1].nextSibling,c=null;for(;s<o||a<i;)if(t[s]!==n[a]){for(;t[o-1]===n[i-1];)o--,i--;if(o===s){const t=i<r?a?n[a-1].nextSibling:n[i-a]:l;for(;a<i;)e.insertBefore(n[a++],t)}else if(i===a)for(;s<o;)c&&c.has(t[s])||t[s].remove(),s++;else if(t[s]===n[i-1]&&n[a]===t[o-1]){const r=t[--o].nextSibling;e.insertBefore(n[a++],t[s++].nextSibling),e.insertBefore(n[--i],r),t[o]=n[i]}else{if(!c){c=new Map;let e=a;for(;e<i;)c.set(n[e],e++)}const r=c.get(t[s]);if(null!=r)if(a<r&&r<i){let l,u=s,d=1;for(;++u<o&&u<i&&null!=(l=c.get(t[u]))&&l===r+d;)d++;if(d>r-a){const o=t[s];for(;a<r;)e.insertBefore(n[a++],o)}else e.replaceChild(n[a++],t[s++])}else s++;else t[s++].remove()}}else s++,a++}(e,n,i):(n&&se(e),ie(e,i));n=i}else if(t.nodeType){if(Array.isArray(n)){if(s)return n=se(e,n,r,t);se(e,n,null,t)}else null!=n&&""!==n&&e.firstChild?e.replaceChild(t,e.firstChild):e.appendChild(t);n=t}}return n}function oe(e,t,n,r){let o=!1;for(let i=0,s=t.length;i<s;i++){let s,a=t[i],l=n&&n[e.length];if(null==a||!0===a||!1===a);else if("object"==(s=typeof a)&&a.nodeType)e.push(a);else if(Array.isArray(a))o=oe(e,a,l)||o;else if("function"===s)if(r){for(;"function"==typeof a;)a=a();o=oe(e,Array.isArray(a)?a:[a],Array.isArray(l)?l:[l])||o}else e.push(a),o=!0;else{const t=String(a);l&&3===l.nodeType&&l.data===t?e.push(l):e.push(document.createTextNode(t))}}return o}function ie(e,t,n=null){for(let r=0,o=t.length;r<o;r++)e.insertBefore(t[r],n)}function se(e,t,n,r){if(void 0===n)return e.textContent="";const o=r||document.createTextNode("");if(t.length){let r=!1;for(let i=t.length-1;i>=0;i--){const s=t[i];if(o!==s){const t=s.parentNode===e;r||i?t&&s.remove():t?e.replaceChild(o,s):e.insertBefore(o,n)}else r=!0}}else e.insertBefore(o,n);return[o]}function ae(e){return Object.keys(e).reduce(((t,n)=>{const r=e[n];var o;return t[n]=Object.assign({},r),ue(r.value)&&(o=r.value,"[object Function]"!==Object.prototype.toString.call(o))&&!Array.isArray(r.value)&&(t[n].value=Object.assign({},r.value)),Array.isArray(r.value)&&(t[n].value=r.value.slice(0)),t}),{})}function le(e){if(e)try{return JSON.parse(e)}catch(t){return e}}function ce(e,t,n,r){if(null==n||!1===n)return e.removeAttribute(t);let o=r?JSON.stringify(n):n;e.__updating[t]=!0,"true"===o&&(o=""),e.setAttribute(t,o),Promise.resolve().then((()=>delete e.__updating[t]))}function ue(e){return null!=e&&("object"==typeof e||"function"==typeof e)}let de;function he(e,t){const n=Object.keys(t);return class extends e{static get observedAttributes(){return n.map((e=>t[e].attribute))}constructor(){super(),this.__initialized=!1,this.__released=!1,this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props={}}connectedCallback(){if(this.__initialized)return;this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props=function(e,t){const n=ae(t);return Object.keys(t).forEach((t=>{const r=n[t],o=e.getAttribute(r.attribute),i=e[t];o&&(r.value=r.parse?le(o):o),null!=i&&(r.value=Array.isArray(i)?i.slice(0):i),r.reflect&&ce(e,r.attribute,r.value,!!r.parse),Object.defineProperty(e,t,{get:()=>r.value,set(e){const n=r.value;r.value=e,r.reflect&&ce(this,r.attribute,r.value,!!r.parse);for(let r=0,o=this.__propertyChangedCallbacks.length;r<o;r++)this.__propertyChangedCallbacks[r](t,e,n)},enumerable:!0,configurable:!0})})),n}(this,t);const e=function(e){return Object.keys(e).reduce(((t,n)=>(t[n]=e[n].value,t)),{})}(this.props),n=this.Component,r=de;try{de=this,this.__initialized=!0,"function"==typeof(o=n)&&0===o.toString().indexOf("class")?new n(e,{element:this}):n(e,{element:this})}finally{de=r}var o}async disconnectedCallback(){if(await Promise.resolve(),this.isConnected)return;this.__propertyChangedCallbacks.length=0;let e=null;for(;e=this.__releaseCallbacks.pop();)e(this);delete this.__initialized,this.__released=!0}attributeChangedCallback(e,n,r){if(this.__initialized&&!this.__updating[e]&&(e=this.lookupProp(e))in t){if(null==r&&!this[e])return;this[e]=t[e].parse?le(r):r}}lookupProp(e){if(t)return n.find((n=>e===n||e===t[n].attribute))}get renderRoot(){return this.shadowRoot||this.attachShadow({mode:"open"})}addReleaseCallback(e){this.__releaseCallbacks.push(e)}addPropertyChangedCallback(e){this.__propertyChangedCallbacks.push(e)}}}function fe(e,t={},n={}){const{BaseElement:r=HTMLElement,extension:o}=n;return n=>{if(!e)throw new Error("tag is required to register a Component");let i=customElements.get(e);return i?(i.prototype.Component=n,i):(i=he(r,function(e){return e?Object.keys(e).reduce(((t,n)=>{const r=e[n];return t[n]=ue(r)&&"value"in r?r:{value:r},t[n].attribute||(t[n].attribute=n.replace(/\.?([A-Z]+)/g,((e,t)=>"-"+t.toLowerCase())).replace("_","-").replace(/^-/,"")),t[n].parse="parse"in t[n]?t[n].parse:"string"!=typeof t[n].value,t}),{}):{}}(t)),i.prototype.Component=n,i.prototype.registeredTag=e,customElements.define(e,i,o),i)}}function pe(e){return(t,n)=>{const{element:r}=n;return m((o=>{const i=function(e){const t=Object.keys(e),n={};for(let r=0;r<t.length;r++){const[o,i]=w(e[t[r]]);Object.defineProperty(n,t[r],{get:o,set(e){i((()=>e))}})}return n}(t);r.addPropertyChangedCallback(((e,t)=>i[e]=t)),r.addReleaseCallback((()=>{r.renderRoot.textContent="",o()}));const s=e(i,n);return te(r.renderRoot,s)}),function(e){if(e.assignedSlot&&e.assignedSlot._$owner)return e.assignedSlot._$owner;let t=e.parentNode;for(;t&&!t._$owner&&(!t.assignedSlot||!t.assignedSlot._$owner);)t=t.parentNode;return t&&t.assignedSlot?t.assignedSlot._$owner:e._$owner}(r))}}const ge="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,ye=e=>e instanceof Uint8Array,me=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),we=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const be=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function ve(e){if(!ye(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=be[e[n]];return t}function Ee(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const t=2*r,o=e.slice(t,t+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function xe(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!ye(e))throw new Error("expected Uint8Array, got "+typeof e);return e}function ke(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!ye(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}let Ae=class{clone(){return this._cloneInto()}};function Se(e){const t=t=>e().update(xe(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function ze(e=32){if(ge&&"function"==typeof ge.getRandomValues)return ge.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Te(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ie={};!function(e){function t(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function n(...e){const t=(e,t)=>n=>e(t(n));return{encode:Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),decode:e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0)}}function r(e){return{encode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("alphabet.encode input should be an array of numbers");return n.map((n=>{if(t(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function o(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function i(e,n="="){if(t(e),"string"!=typeof n)throw new Error("padding chr should be string");return{encode(t){if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("padding.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;t.length*e%8;)t.push(n);return t},decode(t){if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("padding.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=t.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&t[r-1]===n;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return t.slice(0,r)}}}function s(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function a(e,n,r){if(n<2)throw new Error(`convertRadix: wrong from=${n}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let o=0;const i=[],s=Array.from(e);for(s.forEach((e=>{if(t(e),e<0||e>=n)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,t=!0;for(let i=o;i<s.length;i++){const a=s[i],l=n*e+a;if(!Number.isSafeInteger(l)||n*e/n!==e||l-a!=n*e)throw new Error("convertRadix: carry overflow");if(e=l%r,s[i]=Math.floor(l/r),!Number.isSafeInteger(s[i])||s[i]*r+e!==l)throw new Error("convertRadix: carry overflow");t&&(s[i]?t=!1:o=i)}if(i.push(e),t)break}for(let t=0;t<e.length-1&&0===e[t];t++)i.push(0);return i.reverse()}
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=t;const l=(e,t)=>t?l(t,e%t):e,c=(e,t)=>e+(t-l(e,t));function u(e,n,r,o){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(n<=0||n>32)throw new Error(`convertRadix2: wrong from=${n}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(c(n,r)>32)throw new Error(`convertRadix2: carry overflow from=${n} to=${r} carryBits=${c(n,r)}`);let i=0,s=0;const a=2**r-1,l=[];for(const c of e){if(t(c),c>=2**n)throw new Error(`convertRadix2: invalid data word=${c} from=${n}`);if(i=i<<n|c,s+n>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${n}`);for(s+=n;s>=r;s-=r)l.push((i>>s-r&a)>>>0);i&=2**s-1}if(i=i<<r-s&a,!o&&s>=n)throw new Error("Excess padding");if(!o&&i)throw new Error(`Non-zero padding: ${i}`);return o&&s>0&&l.push(i>>>0),l}function d(e){return t(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return a(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(a(t,e,256))}}}function h(e,n=!1){if(t(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(c(8,e)>32||c(e,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return u(Array.from(t),8,e,!n)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(u(t,e,8,n))}}}function f(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(n){}}}function p(e,n){if(t(e),"function"!=typeof n)throw new Error("checksum fn should be function");return{encode(t){if(!(t instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const r=n(t).slice(0,e),o=new Uint8Array(t.length+e);return o.set(t),o.set(r,t.length),o},decode(t){if(!(t instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const r=t.slice(0,-e),o=n(r).slice(0,e),i=t.slice(-e);for(let n=0;n<e;n++)if(o[n]!==i[n])throw new Error("Invalid checksum");return r}}}e.utils={alphabet:r,chain:n,checksum:p,radix:d,radix2:h,join:o,padding:i},e.base16=n(h(4),r("0123456789ABCDEF"),o("")),e.base32=n(h(5),r("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),i(5),o("")),e.base32hex=n(h(5),r("0123456789ABCDEFGHIJKLMNOPQRSTUV"),i(5),o("")),e.base32crockford=n(h(5),r("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),o(""),s((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=n(h(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),i(6),o("")),e.base64url=n(h(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),i(6),o(""));const g=e=>n(d(58),r(e),o(""));e.base58=g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const y=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(t){let n="";for(let r=0;r<t.length;r+=8){const o=t.subarray(r,r+8);n+=e.base58.encode(o).padStart(y[o.length],"1")}return n},decode(t){let n=[];for(let r=0;r<t.length;r+=11){const o=t.slice(r,r+11),i=y.indexOf(o.length),s=e.base58.decode(o);for(let e=0;e<s.length-i;e++)if(0!==s[e])throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(n)}};e.base58check=t=>n(p(4,(e=>t(t(e)))),e.base58);const m=n(r("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o("")),w=[996825010,642813549,513874426,1027748829,705979059];function b(e){const t=e>>25;let n=(33554431&e)<<5;for(let r=0;r<w.length;r++)1==(t>>r&1)&&(n^=w[r]);return n}function v(e,t,n=1){const r=e.length;let o=1;for(let i=0;i<r;i++){const t=e.charCodeAt(i);if(t<33||t>126)throw new Error(`Invalid prefix (${e})`);o=b(o)^t>>5}o=b(o);for(let i=0;i<r;i++)o=b(o)^31&e.charCodeAt(i);for(let i of t)o=b(o)^i;for(let i=0;i<6;i++)o=b(o);return o^=n,m.encode(u([o%2**30],30,5,!1))}function E(e){const t="bech32"===e?1:734539939,n=h(5),r=n.decode,o=n.encode,i=f(r);function s(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const o=(e=r).lastIndexOf("1");if(0===o||-1===o)throw new Error('Letter "1" must be present between prefix and data only');const i=e.slice(0,o),s=e.slice(o+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=m.decode(s).slice(0,-6),l=v(i,a,t);if(!s.endsWith(l))throw new Error(`Invalid checksum in ${e}: expected "${l}"`);return{prefix:i,words:a}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const o=e.length+7+n.length;if(!1!==r&&o>r)throw new TypeError(`Length ${o} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${m.encode(n)}${v(e,n,t)}`},decode:s,decodeToBytes:function(e){const{prefix:t,words:n}=s(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:f(s),fromWords:r,fromWordsUnsafe:i,toWords:o}}e.bech32=E("bech32"),e.bech32m=E("bech32m"),e.utf8={encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)},e.hex=n(h(4),r("0123456789abcdef"),o(""),s((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));const x={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},k=`Invalid encoding type. Available types: ${Object.keys(x).join(", ")}`;e.bytesToString=(e,t)=>{if("string"!=typeof e||!x.hasOwnProperty(e))throw new TypeError(k);if(!(t instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return x[e].encode(t)},e.str=e.bytesToString;e.stringToBytes=(e,t)=>{if(!x.hasOwnProperty(e))throw new TypeError(k);if("string"!=typeof t)throw new TypeError("stringToBytes() expects string");return x[e].decode(t)},e.bytes=e.stringToBytes}(Ie);var _e=new TextDecoder("utf-8");new TextEncoder;var Ce=5e3;function Oe(e){var t,n,r,o,i,s,a,l;let{prefix:c,words:u}=Ie.bech32.decode(e,Ce),d=new Uint8Array(Ie.bech32.fromWords(u));switch(c){case"nprofile":{let e=Le(d);if(!(null==(t=e[0])?void 0:t[0]))throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ve(e[0][0]),relays:e[1]?e[1].map((e=>_e.decode(e))):[]}}}case"nevent":{let e=Le(d);if(!(null==(n=e[0])?void 0:n[0]))throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ve(e[0][0]),relays:e[1]?e[1].map((e=>_e.decode(e))):[],author:(null==(r=e[2])?void 0:r[0])?ve(e[2][0]):void 0,kind:(null==(o=e[3])?void 0:o[0])?parseInt(ve(e[3][0]),16):void 0}}}case"naddr":{let e=Le(d);if(!(null==(i=e[0])?void 0:i[0]))throw new Error("missing TLV 0 for naddr");if(!(null==(s=e[2])?void 0:s[0]))throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!(null==(a=e[3])?void 0:a[0]))throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:_e.decode(e[0][0]),pubkey:ve(e[2][0]),kind:parseInt(ve(e[3][0]),16),relays:e[1]?e[1].map((e=>_e.decode(e))):[]}}}case"nrelay":{let e=Le(d);if(!(null==(l=e[0])?void 0:l[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:_e.decode(e[0][0])}}case"nsec":return{type:c,data:d};case"npub":case"note":return{type:c,data:ve(d)};default:throw new Error(`unknown prefix ${c}`)}}function Le(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],o=n.slice(2,2+r);if(n=n.slice(2+r),o.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(o)}return t}function Be(e){return Pe("npub",Ee(e))}function $e(e){return Pe("note",Ee(e))}function Pe(e,t){return function(e,t){let n=Ie.bech32.toWords(t);return Ie.bech32.encode(e,n,Ce)}(e,t)}var Re=new TextDecoder("utf-8");new TextEncoder;var Ue=5e3;function Ne(e){var t,n,r,o,i,s,a,l;let{prefix:c,words:u}=Ie.bech32.decode(e,Ue),d=new Uint8Array(Ie.bech32.fromWords(u));switch(c){case"nprofile":{let e=je(d);if(!(null==(t=e[0])?void 0:t[0]))throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ve(e[0][0]),relays:e[1]?e[1].map((e=>Re.decode(e))):[]}}}case"nevent":{let e=je(d);if(!(null==(n=e[0])?void 0:n[0]))throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ve(e[0][0]),relays:e[1]?e[1].map((e=>Re.decode(e))):[],author:(null==(r=e[2])?void 0:r[0])?ve(e[2][0]):void 0,kind:(null==(o=e[3])?void 0:o[0])?parseInt(ve(e[3][0]),16):void 0}}}case"naddr":{let e=je(d);if(!(null==(i=e[0])?void 0:i[0]))throw new Error("missing TLV 0 for naddr");if(!(null==(s=e[2])?void 0:s[0]))throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!(null==(a=e[3])?void 0:a[0]))throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Re.decode(e[0][0]),pubkey:ve(e[2][0]),kind:parseInt(ve(e[3][0]),16),relays:e[1]?e[1].map((e=>Re.decode(e))):[]}}}case"nrelay":{let e=je(d);if(!(null==(l=e[0])?void 0:l[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Re.decode(e[0][0])}}case"nsec":return{type:c,data:d};case"npub":case"note":return{type:c,data:ve(d)};default:throw new Error(`unknown prefix ${c}`)}}function je(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],o=n.slice(2,2+r);if(n=n.slice(2+r),o.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(o)}return t}var He=new RegExp(`nostr:(${/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/.source})`),Me=()=>new RegExp(`\\b${He.source}\\b`,"g");var De={exports:{}};De.exports=function(){function e(e){return e.replace(/\\([(){}[\]#*+\-.!_\\])/g,(function(e,t){return String.fromCharCode(1,n.indexOf(t)+r)})).replace(/(\*\*|__|~~)(\S(?:[\s\S]*?\S)?)\1/g,(function(e,t,n){return"~~"===t?"<del>"+n+"</del>":"<b>"+n+"</b>"})).replace(/(\n|^|\W)([_\*])(\S(?:[\s\S]*?\S)?)\2(\W|$|\n)/g,(function(e,t,n,r,o){return t+"<i>"+r+"</i>"+o})).replace(/(!?)\[([^\]<>]+)\]\((\+?)([^ \)<>]+)(?: "([^\(\)\"]+)")?\)/g,(function(e,t,n,r,i,s){var a=s?' title="'+s+'"':"";return t?'<img src="'+o.href(i)+'" alt="'+n+'"'+a+"/>":(r&&(a+=' target="_blank"'),'<a href="'+o.href(i)+'"'+a+">"+n+"</a>")}))}function t(e){return e.replace(/\x01([\x0f-\x1c])/g,(function(e,t){return n.charAt(t.charCodeAt(0)-r)}))}var n="\\[!]#{()}*+-._",r=16,o=function(n){return n.replace(/.+(?:\n.+)*/g,(function(n){var r=/^\s{4}([^]*)$/.exec(n);if(r)return"<pre><code>"+r[1].replace(/\n    /g,"\n")+"</code></pre>";for(var i,s=[],a=e(n).split("\n"),l=0,c=a.length;c>l;++l){var u=a[l],d=/^\s{0,3}(\#{1,6})\s+(.*?)\s*#*\s*$/.exec(u);if(d)s.push(i=[d[2],"h",d[1].length]);else{var h=/^(\s*)(?:[-*]|(\d[.)])) (.+)$/.exec(u);h?s.push(i=[h[3],h[2]?"ol":"ul",h[1].length]):/^\s{0,3}([-])(\s*\1){2,}\s*$/.test(u)?s.push(i=["","hr"]):i&&"hr"!==i[1]&&"h"!==i[1]?i[0]+="\n"+u:s.push(i=[u,"p",""])}}var f="",p=[];for(l=0,c=s.length;c>l;++l){var g=(i=s[l])[0],y=i[1],m=i[2];if("ul"===y||"ol"===y)!p.length||m>p[0][1]?(p.unshift([y,m]),f+="<"+p[0][0]+"><li>"+g):p.length>1&&m<=p[1][1]?(f+="</li></"+p.shift()[0]+">",--l):f+="</li><li>"+g;else{for(;p.length;)f+="</li></"+p.shift()[0]+">";f+="hr"===y?"<hr/>":"<"+y+m+o.headAttrs(m,g)+">"+g+"</"+y+m+">"}}for(;p.length;)f+="</li></"+p.shift()[0]+">";return t(f)}))};return o.href=function(e){return e},o.headAttrs=function(e,t){return""},o}();const qe=Te(De.exports);function Ve(e,{delay:t}={}){if("number"!=typeof t&&void 0!==t)throw new TypeError(`Expected \`interval\` to be of type \`number\` but received type \`${typeof t}\``);const n=void 0===t?async()=>{}:(r=t,async()=>new Promise((e=>{setTimeout(e,r)})));var r;let o=[];return t=>{o.push(t),1===o.length&&(async()=>{await n(),e(o),o=[]})()}}const Fe=Symbol("store-raw"),Ke=Symbol("store-node"),We=Symbol("store-has"),Ze=Symbol("store-self");function Je(e){let t=e[n];if(!t&&(Object.defineProperty(e,n,{value:t=new Proxy(e,nt)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let o=0,i=n.length;o<i;o++){const i=n[o];r[i].get&&Object.defineProperty(e,i,{enumerable:r[i].enumerable,get:r[i].get.bind(t)})}}return t}function Ge(e){let t;return null!=e&&"object"==typeof e&&(e[n]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Ye(e,t=new Set){let n,r,o,i;if(n=null!=e&&e[Fe])return n;if(!Ge(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let n=0,i=e.length;n<i;n++)o=e[n],(r=Ye(o,t))!==o&&(e[n]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const n=Object.keys(e),s=Object.getOwnPropertyDescriptors(e);for(let a=0,l=n.length;a<l;a++)i=n[a],s[i].get||(o=e[i],(r=Ye(o,t))!==o&&(e[i]=r))}return e}function Qe(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Xe(e,t,n){if(e[t])return e[t];const[r,o]=w(n,{equals:!1,internal:!0});return r.$=o,e[t]=r}function et(e){_()&&Xe(Qe(e,Ke),Ze)()}function tt(e){return et(e),Reflect.ownKeys(e)}const nt={get(e,t,o){if(t===Fe)return e;if(t===n)return o;if(t===r)return et(e),o;const i=Qe(e,Ke),s=i[t];let a=s?s():e[t];if(t===Ke||t===We||"__proto__"===t)return a;if(!s){const n=Object.getOwnPropertyDescriptor(e,t);!_()||"function"==typeof a&&!e.hasOwnProperty(t)||n&&n.get||(a=Xe(i,t,a)())}return Ge(a)?Je(a):a},has:(e,t)=>t===Fe||t===n||t===r||t===Ke||t===We||"__proto__"===t||(_()&&Xe(Qe(e,We),t)(),t in e),set:()=>!0,deleteProperty:()=>!0,ownKeys:tt,getOwnPropertyDescriptor:function(e,t){const r=Reflect.getOwnPropertyDescriptor(e,t);return r&&!r.get&&r.configurable&&t!==n&&t!==Ke?(delete r.value,delete r.writable,r.get=()=>e[n][t],r):r}};function rt(e,t,n,r=!1){if(!r&&e[t]===n)return;const o=e[t],i=e.length;void 0===n?(delete e[t],e[We]&&e[We][t]&&void 0!==o&&e[We][t].$()):(e[t]=n,e[We]&&e[We][t]&&void 0===o&&e[We][t].$());let s,a=Qe(e,Ke);if((s=Xe(a,t,o))&&s.$((()=>n)),Array.isArray(e)&&e.length!==i){for(let t=e.length;t<i;t++)(s=a[t])&&s.$();(s=Xe(a,"length",i))&&s.$(e.length)}(s=a[Ze])&&s.$()}function ot(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const o=n[r];rt(e,o,t[o])}}function it(e,t,n=[]){let r,o=e;if(t.length>1){r=t.shift();const i=typeof r,s=Array.isArray(e);if(Array.isArray(r)){for(let o=0;o<r.length;o++)it(e,[r[o]].concat(t),n);return}if(s&&"function"===i){for(let o=0;o<e.length;o++)r(e[o],o)&&it(e,[o].concat(t),n);return}if(s&&"object"===i){const{from:o=0,to:i=e.length-1,by:s=1}=r;for(let r=o;r<=i;r+=s)it(e,[r].concat(t),n);return}if(t.length>1)return void it(e[r],t,[r].concat(n));o=e[r],n=[r].concat(n)}let i=t[0];"function"==typeof i&&(i=i(o,n),i===o)||void 0===r&&null==i||(i=Ye(i),void 0===r||Ge(o)&&Ge(i)&&!Array.isArray(i)?ot(o,i):rt(e,r,i))}function st(...[e,t]){const n=Ye(e||{}),r=Array.isArray(n);return[Je(n),function(...e){A((()=>{r&&1===e.length?function(e,t){if("function"==typeof t&&(t=t(e)),t=Ye(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const r=t[n];e[n]!==r&&rt(e,n,r)}rt(e,"length",r)}else ot(e,t)}(n,e[0]):it(n,e)}))}]}const at={get(e,t,o){if(t===Fe)return e;if(t===n)return o;if(t===r)return et(e),o;const i=Qe(e,Ke),s=i[t];let a=s?s():e[t];if(t===Ke||t===We||"__proto__"===t)return a;if(!s){const n=Object.getOwnPropertyDescriptor(e,t),r="function"==typeof a;if(!_()||r&&!e.hasOwnProperty(t)||n&&n.get){if(null!=a&&r&&a===Array.prototype[t])return(...e)=>A((()=>Array.prototype[t].apply(o,e)))}else a=Xe(i,t,a)()}return Ge(a)?lt(a):a},has:(e,t)=>t===Fe||t===n||t===r||t===Ke||t===We||"__proto__"===t||(_()&&Xe(Qe(e,We),t)(),t in e),set:(e,t,n)=>(A((()=>rt(e,t,Ye(n)))),!0),deleteProperty:(e,t)=>(A((()=>rt(e,t,void 0,!0))),!0),ownKeys:tt,getOwnPropertyDescriptor:function(e,t){const r=Reflect.getOwnPropertyDescriptor(e,t);return!r||r.get||r.set||!r.configurable||t===n||t===Ke||(delete r.value,delete r.writable,r.get=()=>e[n][t],r.set=r=>e[n][t]=r),r}};function lt(e){let t=e[n];if(!t){Object.defineProperty(e,n,{value:t=new Proxy(e,at)});const r=Object.keys(e),o=Object.getOwnPropertyDescriptors(e),i=Object.getPrototypeOf(e),s=null!==i&&null!==e&&"object"==typeof e&&!Array.isArray(e)&&i!==Object.prototype;if(s){const e=Object.getOwnPropertyDescriptors(i);r.push(...Object.keys(e)),Object.assign(o,e)}for(let n=0,a=r.length;n<a;n++){const i=r[n];if(!s||"constructor"!==i){if(o[i].get){const n=o[i].get.bind(t);Object.defineProperty(e,i,{get:n,configurable:!0})}if(o[i].set){const n=o[i].set,r=e=>A((()=>n.call(t,e)));Object.defineProperty(e,i,{set:r,configurable:!0})}}}}return t}function ct(e,t){return lt(Ye(e||{}))}const ut=Symbol("store-root");function dt(e,t,n,r,o){const i=t[n];if(e===i)return;const s=Array.isArray(e);if(n!==ut&&(!Ge(e)||!Ge(i)||s!==Array.isArray(i)||o&&e[o]!==i[o]))return void rt(t,n,e);if(s){if(e.length&&i.length&&(!r||o&&e[0]&&null!=e[0][o])){let t,n,s,a,l,c,u,d;for(s=0,a=Math.min(i.length,e.length);s<a&&(i[s]===e[s]||o&&i[s]&&e[s]&&i[s][o]===e[s][o]);s++)dt(e[s],i,s,r,o);const h=new Array(e.length),f=new Map;for(a=i.length-1,l=e.length-1;a>=s&&l>=s&&(i[a]===e[l]||o&&i[s]&&e[s]&&i[a][o]===e[l][o]);a--,l--)h[l]=i[a];if(s>l||s>a){for(n=s;n<=l;n++)rt(i,n,e[n]);for(;n<e.length;n++)rt(i,n,h[n]),dt(e[n],i,n,r,o);return void(i.length>e.length&&rt(i,"length",e.length))}for(u=new Array(l+1),n=l;n>=s;n--)c=e[n],d=o&&c?c[o]:c,t=f.get(d),u[n]=void 0===t?-1:t,f.set(d,n);for(t=s;t<=a;t++)c=i[t],d=o&&c?c[o]:c,n=f.get(d),void 0!==n&&-1!==n&&(h[n]=i[t],n=u[n],f.set(d,n));for(n=s;n<e.length;n++)n in h?(rt(i,n,h[n]),dt(e[n],i,n,r,o)):rt(i,n,e[n])}else for(let t=0,n=e.length;t<n;t++)dt(e[t],i,t,r,o);return void(i.length>e.length&&rt(i,"length",e.length))}const a=Object.keys(e);for(let c=0,u=a.length;c<u;c++)dt(e[a[c]],i,a[c],r,o);const l=Object.keys(i);for(let c=0,u=l.length;c<u;c++)void 0===e[l[c]]&&rt(i,l[c],void 0)}function ht(e,t={}){const{merge:n,key:r="id"}=t,o=Ye(e);return e=>{if(!Ge(e)||!Ge(o))return o;const t=dt(o,{[ut]:e},ut,n,r);return void 0===t?e:t}}const ft=(e,t)=>t.some((t=>e instanceof t));let pt,gt;const yt=new WeakMap,mt=new WeakMap,wt=new WeakMap,bt=new WeakMap,vt=new WeakMap;let Et={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return mt.get(e);if("objectStoreNames"===t)return e.objectStoreNames||wt.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return At(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function xt(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(gt||(gt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(St(this),t),At(yt.get(this))}:function(...t){return At(e.apply(St(this),t))}:function(t,...n){const r=e.call(St(this),t,...n);return wt.set(r,t.sort?t.sort():[t]),At(r)}}function kt(e){return"function"==typeof e?xt(e):(e instanceof IDBTransaction&&function(e){if(mt.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)}));mt.set(e,t)}(e),ft(e,pt||(pt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Et):e)}function At(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(At(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&yt.set(t,e)})).catch((()=>{})),vt.set(t,e),t}(e);if(bt.has(e))return bt.get(e);const t=kt(e);return t!==e&&(bt.set(e,t),vt.set(t,e)),t}const St=e=>vt.get(e);const zt=["get","getKey","getAll","getAllKeys","count"],Tt=["put","add","delete","clear"],It=new Map;function _t(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(It.get(t))return It.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=Tt.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!zt.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,o?"readwrite":"readonly");let s=i.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),o&&i.done]))[0]};return It.set(t,i),i}Et=(e=>({...e,get:(t,n,r)=>_t(t,n)||e.get(t,n,r),has:(t,n)=>!!_t(t,n)||e.has(t,n)}))(Et);const Ct=new Map;function Ot(e,t){return[e,t].sort().join(",")}async function Lt(e,t){if(!Ct.get(e.id)&&t&&e.po){const n=e.pk===t.pk?e.po:e.pk,r=await t.nip04.decrypt(n,e.c);Ct.set(e.id,r)}}const Bt={events:"id",aggregates:["eid","k"],profiles:["pk"],relays:["n","a"]},$t=async(e,t)=>{if(t<3){const t=[...e.objectStoreNames];await Promise.all(t.map((t=>e.deleteObjectStore(t))))}const n=e.createObjectStore("events",{keyPath:Bt.events});n.createIndex("a","a"),n.createIndex("ro","ro"),n.createIndex("r","r"),n.createIndex("d","d"),n.createIndex("k","k"),n.createIndex("dm","dm"),e.createObjectStore("aggregates",{keyPath:Bt.aggregates});e.createObjectStore("profiles",{keyPath:Bt.profiles}).createIndex("l","l");e.createObjectStore("relays",{keyPath:Bt.relays}).createIndex("a","a")},Pt=e=>{var t,n;const r=function(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(const r of e.tags)"e"===r[0]&&r[1]&&n.push(r),"p"===r[0]&&r[1]&&t.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let r=0;r<n.length;r++){const e=n[r],[o,i,s,a]=e,l={id:i,relays:s?[s]:[]},c=0===r,u=r===n.length-1;"root"!==a?"reply"!==a?"mention"!==a?c?t.root=l:u?t.reply=l:t.mentions.push(l):t.mentions.push(l):t.reply=l:t.root=l}return t}(e),o=e.tags.find((e=>"a"===e[0])),i=o&&o[1],s=o&&"mention"===o[3],a=e.tags.find((e=>"r"===e[0])),l=a&&a[1],c=e.tags.filter((e=>"t"===e[0])),u=[...new Set(c.map((e=>e[1])))],d=e.tags.find((e=>"d"===e[0])),h=d&&d[1],f=e.tags.find((e=>"title"===e[0])),p=f&&f[1],g=e.tags.find((e=>"p"===e[0])),y=g&&g[1];let m="";return 4===e.kind&&y&&(m=Ot(y,e.pubkey)),{id:e.id??"",k:e.kind,c:e.content,ts:e.created_at,pk:e.pubkey,ro:null==(t=r.root)?void 0:t.id,re:null==(n=r.reply)?void 0:n.id,me:r.mentions.map((e=>e.id)),p:r.profiles.map((e=>e.pubkey)),dm:m,po:y,a:i,am:s,r:l,t:u,d:h,tl:p}};let Rt,Ut={},Nt=!0;const jt=async()=>{if(!1!==Nt)try{return Rt||(Rt=await function(e,t,{blocked:n,upgrade:r,blocking:o,terminated:i}={}){const s=indexedDB.open(e,t),a=At(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(At(s.result),e.oldVersion,e.newVersion,At(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),o&&e.addEventListener("versionchange",(e=>o(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("zapthreads",3,{upgrade:$t}))}catch(e){Nt=!1}},Ht=e=>{const t=x(z(e,(()=>{const[t,n,r]=e(),[o,{mutate:i}]=k((()=>Wt[t]),(()=>Dt(t,n,r)),{initialValue:[],storage:Zt});return Dt(t,n,r).then(i),o})));return()=>t()()},Mt=e=>{const t=x(z(e,(()=>{const[t,n,r]=e(),[o,{mutate:i}]=k((()=>Wt[t]),(()=>qt(t,n,r)),{initialValue:void 0,storage:Zt});return qt(t,n,r).then(i),o})));return()=>t()()},Dt=async(e,t,n)=>{const r=await jt();if(!r){const r=Ut[e];if(r){if(n){const e=Array.isArray(t)?t:[t];return Object.values(r).filter((t=>e.includes(t[n.index])))}return Object.values(r)}return[]}if(t&&n){if(Array.isArray(t)){const o=t.map((t=>r.getAllFromIndex(e,n.index,t)));return(await Promise.all(o)).flat()}return r.getAllFromIndex(e,n.index,t)}return r.getAll(e)},qt=async(e,t,n)=>{const r=await jt();if(r)return n?r.getFromIndex(e,n.index,t):r.get(e,t);{const r=Ut[e];if(r){if(n)return Object.values(r).find((e=>e[n.index]===t));return r[(t.lower?t.lower:t).toString()]}}},Vt={},Ft=(e,t)=>{Ut[e]??(Ut[e]={});for(const n of t){let t=Bt[e];t=Array.isArray(t)?t:[t];const r=t.map((e=>n[e])).join(",");Ut[e][r]=n}},Kt=async(e,t,n={immediate:!1})=>{const r=await jt();if(n.immediate)return r?r.put(e,t):Ft(e,[t]),void(Wt[e]=+new Date);Vt[e]||(Vt[e]=Ve((async t=>{if(!r)return Ft(e,t),void(Wt[e]=+new Date);const n=r.transaction(e,"readwrite");await Promise.all([...t.map((e=>n.store.put(e))),n.done])&&(Wt[e]=+new Date)}),{delay:96})),Vt[e](t)},Wt=ct({});function Zt(e){const[t,n]=st({value:e});return[()=>t.value,e=>{const r=Ye(t.value);return"function"==typeof e&&(e=e(r)),n("value",ht(e)),t.value}]}const Jt=async(e,t,n,r)=>{const o=+new Date,i=[...new Set(t)].filter((e=>{const t=r.find((t=>t.pk===e));return!((null==t?void 0:t.l)&&t.l>o-216e5)})).filter((e=>!!e));if(0===i.length)return;const s=await e.querySync(n,{kinds:[0],authors:i});for(const a of i){const e=s.find((e=>e.pubkey===a));if(e){const t=JSON.parse(e.content),n=e.pubkey,i={pk:n,ts:e.created_at,i:t.image||t.picture,n:t.displayName||t.display_name||t.name},s=r.find((e=>e.pk===n));!s||!(null==s?void 0:s.n)||s.ts<i.ts?Kt("profiles",{...i,l:o}):Kt("profiles",{...s,l:o})}}},Gt=new RegExp("(?<=^|\\s)https?:\\/\\/[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&\\/\\/=]*)","gi"),Yt=/(\S*(?:png|jpg|jpeg|gif|webp))/gi,Qt=new RegExp("(?<=^|\\s)@?((naddr|npub|nevent|note)[a-z0-9]{20,})","g"),Xt=/\`(.*?)\`/g,en=/\B\#([a-zA-Z0-9]+\b)(?!;)/g,tn=(e,t,n=[])=>{let r=e.c;const o=t.urlPrefixes,i=t.profiles;r=r.replace(Gt,(e=>e.match(Yt)?`![image](${e})`:`[${e}](${e})`));const s=[...new Set(e.t)];if(s.length>0){const e=new RegExp(`(^|\\s)\\#(${s.join("|")})`,"gi");r=r.replaceAll(e,`$1[#$2](${o.tag}$2)`)}return r=r.replaceAll(Qt,"nostr:$1"),r=function(e,t){return e.replaceAll(Me(),((e,n)=>t({uri:e,value:n,decoded:Ne(n)})))}(r,(({decoded:e,value:t})=>{switch(e.type){case"nprofile":let r=i().find((t=>t.pk===e.data.pubkey));return`[@${(null==r?void 0:r.n)||rn(t)}](${o.nprofile}${t})`;case"npub":let s=i().find((t=>t.pk===e.data));return`[@${(null==s?void 0:s.n)||rn(t)}](${o.npub}${t})`;case"note":return`[@${rn(t)}](${o.note}${t})`;case"naddr":const a=e.data,l=n.find((e=>e.pk===a.pubkey&&e.d===a.identifier));return l&&l.tl?`[${l.tl}](${o.naddr}${t})`:`[@${rn(t)}](${o.naddr}${t})`;case"nevent":return`[@${rn(t)}](${o.nevent}${t})`;default:return t}})),r=r.replaceAll(Xt,"<code>$1</code>"),qe(r.trim())},nn=e=>{const t=[],n=function*(e){const t=e.matchAll(Me());for(const r of t)try{const[e,t]=r;yield{uri:e,value:t,decoded:Ne(t),start:r.index,end:r.index+e.length}}catch(n){}}(e);for(const i of n){if("npub"===i.decoded.type&&t.push(["p",i.decoded.data]),"naddr"===i.decoded.type){const e=i.decoded.data;t.push(["a",`${e.kind}:${e.pubkey}:${e.identifier}`,"","mention"])}"nevent"===i.decoded.type&&t.push(["e",i.decoded.data.id]),"note"===i.decoded.type&&t.push(["e",i.decoded.data])}const r=e.matchAll(en),o=new Set([...r].map((e=>e[1].toLowerCase())));for(const i of o)t.push(["t",i]);return t},rn=e=>e.substring(0,8)+"..."+e.substring(e.length-4),on=e=>e.sort(((e,t)=>(e.ts||0)>=(t.ts||0)?-1:1)),sn=20,an='data:image/svg+xml;utf-8,<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><circle cx="512" cy="512" r="512" fill="%23333" fill-rule="evenodd" /></svg>',ln=e=>{const t=new Date,n=Math.floor((t.getTime()-e)/1e3);if(n<60)return"now";if(n<3600){const e=Math.floor(n/60);return`${e} minute${1===e?"":"s"} ago`}if(n<=86400){const e=Math.floor(n/3600);return`${e} hour${1===e?"":"s"} ago`}if(n<=604800){const e=Math.floor(n/86400);return`${e} day${1===e?"":"s"} ago`}if(n>604800){const n=new Date(e);return"on "+n.toLocaleDateString("en-us",{day:"numeric",month:"long"})+(n.getFullYear()===t.getFullYear()?"":" "+n.getFullYear())}return""},cn=e=>e.children.reduce(((e,t)=>e+cn(t)),e.children.length),un=/\/+$/,dn=(e,t=!0)=>{const n=new URL(e);return n.hash="",t&&(n.pathname=n.pathname.replace(un,"")),n.toString()},hn=(e,t)=>{let n=e.map((e=>({...e,children:[]})));const r=new Set(n.filter((e=>{if(t){const n=t.id===(e.re||e.ro);return n&&(e.parent=t),n}return!n.find((t=>t.id===(e.re||e.ro)))})));n=n.filter((e=>!r.has(e)));for(let o of r)o.children.push(...hn(n,o));return[...r]},fn=ct({}),pn=["reply","likes","zaps","publish","watch","replyAnonymously","hideContent"],gn=e=>pn.includes(e);function yn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function mn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function wn(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}const bn="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,vn=e=>e instanceof Uint8Array,En=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),xn=(e,t)=>e<<32-t|e>>>t;
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function kn(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!vn(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class An{clone(){return this._cloneInto()}}function Sn(e){const t=t=>e().update(kn(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function zn(e=32){if(bn&&"function"==typeof bn.getRandomValues)return bn.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}let Tn=class extends An{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=En(this.buffer)}update(e){wn(this);const{view:t,buffer:n,blockLen:r}=this,o=(e=kn(e)).length;for(let i=0;i<o;){const s=Math.min(r-this.pos,o-i);if(s!==r)n.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=En(e);for(;r<=o-i;i+=r)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){wn(this),function(e,t){mn(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:o}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let u=i;u<r;u++)t[u]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),a=Number(n&i),l=r?4:0,c=r?0:4;e.setUint32(t+l,s,r),e.setUint32(t+c,a,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const s=En(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)s.setUint32(4*u,c[u],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:o,destroyed:i,pos:s}=this;return e.length=r,e.pos=s,e.finished=o,e.destroyed=i,r%t&&e.buffer.set(n),e}};const In=(e,t,n)=>e&t^e&n^t&n,_n=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Cn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),On=new Uint32Array(64);let Ln=class extends Tn{constructor(){super(64,32,8,!1),this.A=0|Cn[0],this.B=0|Cn[1],this.C=0|Cn[2],this.D=0|Cn[3],this.E=0|Cn[4],this.F=0|Cn[5],this.G=0|Cn[6],this.H=0|Cn[7]}get(){const{A:e,B:t,C:n,D:r,E:o,F:i,G:s,H:a}=this;return[e,t,n,r,o,i,s,a]}set(e,t,n,r,o,i,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(e,t){for(let d=0;d<16;d++,t+=4)On[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const e=On[d-15],t=On[d-2],n=xn(e,7)^xn(e,18)^e>>>3,r=xn(t,17)^xn(t,19)^t>>>10;On[d]=r+On[d-7]+n+On[d-16]|0}let{A:n,B:r,C:o,D:i,E:s,F:a,G:l,H:c}=this;for(let d=0;d<64;d++){const e=c+(xn(s,6)^xn(s,11)^xn(s,25))+((u=s)&a^~u&l)+_n[d]+On[d]|0,t=(xn(n,2)^xn(n,13)^xn(n,22))+In(n,r,o)|0;c=l,l=a,a=s,s=i+e|0,i=o,o=r,r=n,n=e+t|0}var u;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(n,r,o,i,s,a,l,c)}roundClean(){On.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Bn=Sn((()=>new Ln)),$n=BigInt(0),Pn=BigInt(1),Rn=BigInt(2),Un=e=>e instanceof Uint8Array,Nn=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function jn(e){if(!Un(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Nn[e[n]];return t}function Hn(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function Mn(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function Dn(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const t=2*r,o=e.slice(t,t+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function qn(e){return Mn(jn(e))}function Vn(e){if(!Un(e))throw new Error("Uint8Array expected");return Mn(jn(Uint8Array.from(e).reverse()))}function Fn(e,t){return Dn(e.toString(16).padStart(2*t,"0"))}function Kn(e,t){return Fn(e,t).reverse()}function Wn(e,t,n){let r;if("string"==typeof t)try{r=Dn(t)}catch(i){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${i}`)}else{if(!Un(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const o=r.length;if("number"==typeof n&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function Zn(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!Un(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}const Jn=e=>(Rn<<BigInt(e-1))-Pn,Gn=e=>new Uint8Array(e),Yn=e=>Uint8Array.from(e);function Qn(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=Gn(e),o=Gn(e),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},a=(...e)=>n(o,r,...e),l=(e=Gn())=>{o=a(Yn([0]),e),r=a(),0!==e.length&&(o=a(Yn([1]),e),r=a())},c=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return Zn(...n)};return(e,t)=>{let n;for(s(),l(e);!(n=t(c()));)l();return s(),n}}const Xn={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function er(e,t,n={}){const r=(t,n,r)=>{const o=Xn[n];if("function"!=typeof o)throw new Error(`Invalid validator "${n}", expected function`);const i=e[t];if(!(r&&void 0===i||o(i,e)))throw new Error(`Invalid param ${String(t)}=${i} (${typeof i}), expected ${n}`)};for(const[o,i]of Object.entries(t))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return e}const tr=Object.freeze(Object.defineProperty({__proto__:null,bitGet:function(e,t){return e>>BigInt(t)&Pn},bitLen:function(e){let t;for(t=0;e>$n;e>>=Pn,t+=1);return t},bitMask:Jn,bitSet:(e,t,n)=>e|(n?Pn:$n)<<BigInt(t),bytesToHex:jn,bytesToNumberBE:qn,bytesToNumberLE:Vn,concatBytes:Zn,createHmacDrbg:Qn,ensureBytes:Wn,equalBytes:function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},hexToBytes:Dn,hexToNumber:Mn,numberToBytesBE:Fn,numberToBytesLE:Kn,numberToHexUnpadded:Hn,numberToVarBytesBE:function(e){return Dn(Hn(e))},utf8ToBytes:function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))},validateObject:er},Symbol.toStringTag,{value:"Module"})),nr=BigInt(0),rr=BigInt(1),or=BigInt(2),ir=BigInt(3),sr=BigInt(4),ar=BigInt(5),lr=BigInt(8);
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function cr(e,t){const n=e%t;return n>=nr?n:t+n}function ur(e,t,n){if(n<=nr||t<nr)throw new Error("Expected power/modulo > 0");if(n===rr)return nr;let r=rr;for(;t>nr;)t&rr&&(r=r*e%n),e=e*e%n,t>>=rr;return r}function dr(e,t,n){let r=e;for(;t-- >nr;)r*=r,r%=n;return r}function hr(e,t){if(e===nr||t<=nr)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=cr(e,t),r=t,o=nr,i=rr;for(;n!==nr;){const e=r%n,t=o-i*(r/n);r=n,n=e,o=i,i=t}if(r!==rr)throw new Error("invert: does not exist");return cr(o,t)}function fr(e){if(e%sr===ir){const t=(e+rr)/sr;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%lr===ar){const t=(e-ar)/lr;return function(e,n){const r=e.mul(n,or),o=e.pow(r,t),i=e.mul(n,o),s=e.mul(e.mul(i,or),o),a=e.mul(i,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-rr)/or;let n,r,o;for(n=e-rr,r=0;n%or===nr;n/=or,r++);for(o=or;o<e&&ur(o,t,e)!==e-rr;o++);if(1===r){const t=(e+rr)/sr;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const i=(n+rr)/or;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,l=e.pow(e.mul(e.ONE,o),n),c=e.pow(s,i),u=e.pow(s,n);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(u);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);const n=e.pow(l,rr<<BigInt(a-t-1));l=e.sqr(n),c=e.mul(c,n),u=e.mul(u,l),a=t}return c}}(e)}BigInt(9),BigInt(16);const pr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function gr(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function yr(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function mr(e){const t=yr(e);return t+Math.ceil(t/2)}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const wr=BigInt(0),br=BigInt(1);function vr(e){return er(e.Fp,pr.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),er(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...gr(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const{bytesToNumberBE:Er,hexToBytes:xr}=tr,kr={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=kr;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Er(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=kr,n="string"==typeof e?xr(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:o,l:i}=kr._parseInt(n.subarray(2)),{d:s,l:a}=kr._parseInt(i);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},r=t(n(e.s)),o=t(n(e.r)),i=r.length/2,s=o.length/2,a=n(i),l=n(s);return`30${n(s+i+4)}02${l}${o}02${a}${r}`}},Ar=BigInt(0),Sr=BigInt(1);BigInt(2);const zr=BigInt(3);function Tr(e){const t=function(e){const t=vr(e);er(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const o=t.toAffine();return Zn(Uint8Array.from([4]),n.toBytes(o.x),n.toBytes(o.y))}),o=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function i(e){const{a:r,b:o}=t,i=n.sqr(e),s=n.mul(i,e);return n.add(n.add(s,n.mul(e,r)),o)}if(!n.eql(n.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"==typeof e&&Ar<e&&e<t.n}function a(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:o,n:i}=t;if(n&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=jn(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"==typeof e?e:qn(Wn("private key",e,r))}catch(l){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return o&&(s=cr(s,i)),a(s),s}const c=new Map;function u(e){if(!(e instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof d)throw new Error("projective point not allowed");const o=e=>n.eql(e,n.ZERO);return o(t)&&o(r)?d.ZERO:new d(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(d.fromAffine)}static fromHex(e){const t=d.fromAffine(o(Wn("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return d.BASE.multiply(l(e))}_setWindowSize(e){this._WINDOW_SIZE=e,c.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const o=n.sqr(r),s=i(e);if(!n.eql(o,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){u(e);const{px:t,py:r,pz:o}=this,{px:i,py:s,pz:a}=e,l=n.eql(n.mul(t,a),n.mul(i,o)),c=n.eql(n.mul(r,a),n.mul(s,o));return l&&c}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,o=n.mul(r,zr),{px:i,py:s,pz:a}=this;let l=n.ZERO,c=n.ZERO,u=n.ZERO,h=n.mul(i,i),f=n.mul(s,s),p=n.mul(a,a),g=n.mul(i,s);return g=n.add(g,g),u=n.mul(i,a),u=n.add(u,u),l=n.mul(e,u),c=n.mul(o,p),c=n.add(l,c),l=n.sub(f,c),c=n.add(f,c),c=n.mul(l,c),l=n.mul(g,l),u=n.mul(o,u),p=n.mul(e,p),g=n.sub(h,p),g=n.mul(e,g),g=n.add(g,u),u=n.add(h,h),h=n.add(u,h),h=n.add(h,p),h=n.mul(h,g),c=n.add(c,h),p=n.mul(s,a),p=n.add(p,p),h=n.mul(p,g),l=n.sub(l,h),u=n.mul(p,f),u=n.add(u,u),u=n.add(u,u),new d(l,c,u)}add(e){u(e);const{px:r,py:o,pz:i}=this,{px:s,py:a,pz:l}=e;let c=n.ZERO,h=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,zr);let y=n.mul(r,s),m=n.mul(o,a),w=n.mul(i,l),b=n.add(r,o),v=n.add(s,a);b=n.mul(b,v),v=n.add(y,m),b=n.sub(b,v),v=n.add(r,i);let E=n.add(s,l);return v=n.mul(v,E),E=n.add(y,w),v=n.sub(v,E),E=n.add(o,i),c=n.add(a,l),E=n.mul(E,c),c=n.add(m,w),E=n.sub(E,c),f=n.mul(p,v),c=n.mul(g,w),f=n.add(c,f),c=n.sub(m,f),f=n.add(m,f),h=n.mul(c,f),m=n.add(y,y),m=n.add(m,y),w=n.mul(p,w),v=n.mul(g,v),m=n.add(m,w),w=n.sub(y,w),w=n.mul(p,w),v=n.add(v,w),y=n.mul(m,v),h=n.add(h,y),y=n.mul(E,v),c=n.mul(b,c),c=n.sub(c,y),y=n.mul(b,m),f=n.mul(E,f),f=n.add(f,y),new d(c,h,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(d.ZERO)}wNAF(e){return f.wNAFCached(this,c,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(d.fromAffine)}))}multiplyUnsafe(e){const r=d.ZERO;if(e===Ar)return r;if(a(e),e===Sr)return this;const{endo:o}=t;if(!o)return f.unsafeLadder(this,e);let{k1neg:i,k1:s,k2neg:l,k2:c}=o.splitScalar(e),u=r,h=r,p=this;for(;s>Ar||c>Ar;)s&Sr&&(u=u.add(p)),c&Sr&&(h=h.add(p)),p=p.double(),s>>=Sr,c>>=Sr;return i&&(u=u.negate()),l&&(h=h.negate()),h=new d(n.mul(h.px,o.beta),h.py,h.pz),u.add(h)}multiply(e){a(e);let r,o,i=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:a,k2:l}=s.splitScalar(i);let{p:c,f:u}=this.wNAF(t),{p:h,f:p}=this.wNAF(l);c=f.constTimeNegate(e,c),h=f.constTimeNegate(a,h),h=new d(n.mul(h.px,s.beta),h.py,h.pz),r=c.add(h),o=u.add(p)}else{const{p:e,f:t}=this.wNAF(i);r=e,o=t}return d.normalizeZ([r,o])[0]}multiplyAndAddUnsafe(e,t,n){const r=d.BASE,o=(e,t)=>t!==Ar&&t!==Sr&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),i=o(this,t).add(o(e,n));return i.is0()?void 0:i}toAffine(e){const{px:t,py:r,pz:o}=this,i=this.is0();null==e&&(e=i?n.ONE:n.inv(o));const s=n.mul(t,e),a=n.mul(r,e),l=n.mul(o,e);if(i)return{x:n.ZERO,y:n.ZERO};if(!n.eql(l,n.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===Sr)return!0;if(n)return n(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===Sr?this:n?n(d,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),r(d,this,e)}toHex(e=!0){return jn(this.toRawBytes(e))}}d.BASE=new d(t.Gx,t.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const h=t.nBitLength,f=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,o=t;for(;n>wr;)n&br&&(r=r.add(o)),o=o.double(),n>>=br;return r},precomputeWindow(e,t){const{windows:n,windowSize:o}=r(t),i=[];let s=e,a=s;for(let r=0;r<n;r++){a=s,i.push(a);for(let e=1;e<o;e++)a=a.add(s),i.push(a);s=a.double()}return i},wNAF(t,o,i){const{windows:s,windowSize:a}=r(t);let l=e.ZERO,c=e.BASE;const u=BigInt(2**t-1),d=2**t,h=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let r=Number(i&u);i>>=h,r>a&&(r-=d,i+=br);const s=t,f=t+Math.abs(r)-1,p=e%2!=0,g=r<0;0===r?c=c.add(n(p,o[s])):l=l.add(n(g,o[f]))}return{p:l,f:c}},wNAFCached(e,t,n,r){const o=e._WINDOW_SIZE||1;let i=t.get(e);return i||(i=this.precomputeWindow(e,o),1!==o&&t.set(e,r(i))),this.wNAF(o,i,n)}}}(d,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:i,isWithinCurveOrder:s}}function Ir(e){const t=function(e){const t=vr(e);return er(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,o=n.BYTES+1,i=2*n.BYTES+1;function s(e){return cr(e,r)}function a(e){return hr(e,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:d}=Tr({...t,toBytes(e,t,r){const o=t.toAffine(),i=n.toBytes(o.x),s=Zn;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),i):s(Uint8Array.from([4]),i,n.toBytes(o.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==o||2!==r&&3!==r){if(t===i&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}{const e=qn(s);if(!(Ar<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=u(e);let o=n.sqrt(t);return!(1&~r)!==((o&Sr)===Sr)&&(o=n.neg(o)),{x:e,y:o}}var a}}),h=e=>jn(Fn(e,t.nByteLength));function f(e){return e>r>>Sr}const p=(e,t,n)=>qn(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=Wn("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=kr.toSig(Wn("DER",e));return new g(t,n)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r:r,s:o,recovery:i}=this,c=b(Wn("msgHash",e));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const u=2===i||3===i?r+t.n:r;if(u>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const d=1&i?"03":"02",f=l.fromHex(d+h(u)),p=a(u),g=s(-c*p),y=s(o*p),m=l.BASE.multiplyAndAddUnsafe(f,g,y);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return Dn(this.toDERHex())}toDERHex(){return kr.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Dn(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const y={isValidPrivateKey(e){try{return c(e),!0}catch(t){return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const e=mr(t.n);return function(e,t,n=!1){const r=e.length,o=yr(t),i=mr(t);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const s=cr(n?qn(e):Vn(e),t-rr)+rr;return n?Kn(s,o):Fn(s,o)}(t.randomBytes(e),t.n)},precompute:(e=8,t=l.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function m(e){const t=e instanceof Uint8Array,n="string"==typeof e,r=(t||n)&&e.length;return t?r===o||r===i:n?r===2*o||r===2*i:e instanceof l}const w=t.bits2int||function(e){const n=qn(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},b=t.bits2int_modN||function(e){return s(w(e))},v=Jn(t.nBitLength);function E(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(Ar<=e&&e<v))throw new Error(`bigint expected < 2^${t.nBitLength}`);return Fn(e,t.nByteLength)}function x(e,r,o=k){if(["recovered","canonical"].some((e=>e in o)))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:u}=t;let{lowS:h,prehash:p,extraEntropy:y}=o;null==h&&(h=!0),e=Wn("msgHash",e),p&&(e=Wn("prehashed msgHash",i(e)));const m=b(e),v=c(r),x=[E(v),E(m)];if(null!=y){const e=!0===y?u(n.BYTES):y;x.push(Wn("extraEntropy",e))}const A=Zn(...x),S=m;return{seed:A,k2sig:function(e){const t=w(e);if(!d(t))return;const n=a(t),r=l.BASE.multiply(t).toAffine(),o=s(r.x);if(o===Ar)return;const i=s(n*s(S+o*v));if(i===Ar)return;let c=(r.x===o?0:2)|Number(r.y&Sr),u=i;return h&&f(i)&&(u=function(e){return f(e)?s(-e):e}(i),c^=1),new g(o,u,c)}}}const k={lowS:t.lowS,prehash:!1},A={lowS:t.lowS,prehash:!1};return l.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return l.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(m(e))throw new Error("first arg must be private key");if(!m(t))throw new Error("second arg must be public key");return l.fromHex(t).multiply(c(e)).toRawBytes(n)},sign:function(e,n,r=k){const{seed:o,k2sig:i}=x(e,n,r),s=t;return Qn(s.hash.outputLen,s.nByteLength,s.hmac)(o,i)},verify:function(e,n,r,o=A){var i;const c=e;if(n=Wn("msgHash",n),r=Wn("publicKey",r),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:u,prehash:d}=o;let h,f;try{if("string"==typeof c||c instanceof Uint8Array)try{h=g.fromDER(c)}catch(k){if(!(k instanceof kr.Err))throw k;h=g.fromCompact(c)}else{if("object"!=typeof c||"bigint"!=typeof c.r||"bigint"!=typeof c.s)throw new Error("PARSE");{const{r:e,s:t}=c;h=new g(e,t)}}f=l.fromHex(r)}catch(S){if("PARSE"===S.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&h.hasHighS())return!1;d&&(n=t.hash(n));const{r:p,s:y}=h,m=b(n),w=a(y),v=s(m*w),E=s(p*w),x=null==(i=l.BASE.multiplyAndAddUnsafe(f,v,E))?void 0:i.toAffine();return!!x&&s(x.x)===p},ProjectivePoint:l,Signature:g,utils:y}}BigInt(4);let _r=class extends An{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");yn(e.outputLen),yn(e.blockLen)}(e);const n=kn(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?e.create().update(n).digest():n);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=e.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),o.fill(0)}update(e){return wn(this),this.iHash.update(e),this}digestInto(e){wn(this),mn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:o,blockLen:i,outputLen:s}=this;return e.finished=r,e.destroyed=o,e.blockLen=i,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Cr=(e,t,n)=>new _r(e,t).update(n).digest();
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function Or(e){return{hash:e,hmac:(t,...n)=>Cr(e,t,function(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!vn(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}(...n)),randomBytes:zn}}Cr.create=(e,t)=>new _r(e,t);
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Lr=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Br=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),$r=BigInt(1),Pr=BigInt(2),Rr=(e,t)=>(e+t/Pr)/t;function Ur(e){const t=Lr,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),l=BigInt(88),c=e*e*e%t,u=c*c*e%t,d=dr(u,n,t)*u%t,h=dr(d,n,t)*u%t,f=dr(h,Pr,t)*c%t,p=dr(f,o,t)*f%t,g=dr(p,i,t)*p%t,y=dr(g,a,t)*g%t,m=dr(y,l,t)*y%t,w=dr(m,a,t)*g%t,b=dr(w,n,t)*u%t,v=dr(b,s,t)*p%t,E=dr(v,r,t)*c%t,x=dr(E,Pr,t);if(!Nr.eql(Nr.sqr(x),e))throw new Error("Cannot find square root");return x}const Nr=function(e,t,n=!1,r={}){if(e<=nr)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:i}=gr(e,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=fr(e),a=Object.freeze({ORDER:e,BITS:o,BYTES:i,MASK:Jn(o),ZERO:nr,ONE:rr,create:t=>cr(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return nr<=t&&t<e},is0:e=>e===nr,isOdd:e=>(e&rr)===rr,neg:t=>cr(-t,e),eql:(e,t)=>e===t,sqr:t=>cr(t*t,e),add:(t,n)=>cr(t+n,e),sub:(t,n)=>cr(t-n,e),mul:(t,n)=>cr(t*n,e),pow:(e,t)=>function(e,t,n){if(n<nr)throw new Error("Expected power > 0");if(n===nr)return e.ONE;if(n===rr)return t;let r=e.ONE,o=t;for(;n>nr;)n&rr&&(r=e.mul(r,o)),o=e.sqr(o),n>>=rr;return r}(a,e,t),div:(t,n)=>cr(t*hr(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>hr(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,o)=>e.is0(r)?t:(n[o]=t,e.mul(t,r))),e.ONE),o=e.inv(r);return t.reduceRight(((t,r,o)=>e.is0(r)?t:(n[o]=e.mul(t,n[o]),e.mul(t,r))),o),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?Kn(e,i):Fn(e,i),fromBytes:e=>{if(e.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${e.length}`);return n?Vn(e):qn(e)}});return Object.freeze(a)}(Lr,void 0,void 0,{sqrt:Ur}),jr=function(e,t){const n=t=>Ir({...e,...Or(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Nr,n:Br,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Br,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-$r*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),a=Rr(i*e,t),l=Rr(-r*e,t);let c=cr(e-a*n-l*o,t),u=cr(-a*r-l*i,t);const d=c>s,h=u>s;if(d&&(c=t-c),h&&(u=t-u),c>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:d,k1:c,k2neg:h,k2:u}}}},Bn),Hr=BigInt(0),Mr=e=>"bigint"==typeof e&&Hr<e&&e<Lr,Dr=e=>"bigint"==typeof e&&Hr<e&&e<Br,qr={};function Vr(e,...t){let n=qr[e];if(void 0===n){const t=Bn(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=Zn(t,t),qr[e]=n}return Bn(Zn(n,...t))}const Fr=e=>e.toRawBytes(!0).slice(1),Kr=e=>Fn(e,32),Wr=e=>cr(e,Lr),Zr=e=>cr(e,Br),Jr=jr.ProjectivePoint,Gr=(e,t,n)=>Jr.BASE.multiplyAndAddUnsafe(e,t,n);function Yr(e){let t=jr.utils.normPrivateKeyToScalar(e),n=Jr.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Zr(-t),bytes:Fr(n)}}function Qr(e){if(!Mr(e))throw new Error("bad x: need 0 < x < p");const t=Wr(e*e);let n=Ur(Wr(t*e+BigInt(7)));n%Pr!==Hr&&(n=Wr(-n));const r=new Jr(e,n,$r);return r.assertValidity(),r}function Xr(...e){return Zr(qn(Vr("BIP0340/challenge",...e)))}function eo(e){return Yr(e).bytes}function to(e,t,n=zn(32)){const r=Wn("message",e),{bytes:o,scalar:i}=Yr(t),s=Wn("auxRand",n,32),a=Kr(i^qn(Vr("BIP0340/aux",s))),l=Vr("BIP0340/nonce",a,o,r),c=Zr(qn(l));if(c===Hr)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=Yr(c),h=Xr(u,o,r),f=new Uint8Array(64);if(f.set(u,0),f.set(Kr(Zr(d+h*i)),32),!no(f,r,o))throw new Error("sign: Invalid signature produced");return f}function no(e,t,n){const r=Wn("signature",e,64),o=Wn("message",t),i=Wn("publicKey",n,32);try{const e=Qr(qn(i)),t=qn(r.subarray(0,32));if(!Mr(t))return!1;const n=qn(r.subarray(32,64));if(!Dr(n))return!1;const s=Xr(Kr(t),Fr(e),o),a=Gr(e,n,Zr(-s));return!(!a||!a.hasEvenY()||a.toAffine().x!==t)}catch(s){return!1}}const ro=(()=>({getPublicKey:eo,sign:to,verify:no,utils:{randomPrivateKey:jr.utils.randomPrivateKey,lift_x:Qr,pointToBytes:Fr,numberToBytesBE:Fn,bytesToNumberBE:qn,taggedHash:Vr,mod:cr}}))();function oo(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function io(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}const so={number:oo,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:io,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");oo(e.outputLen),oo(e.blockLen)},exists:function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){io(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}};class ao extends Ae{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=me(this.buffer)}update(e){so.exists(this);const{view:t,buffer:n,blockLen:r}=this,o=(e=xe(e)).length;for(let i=0;i<o;){const s=Math.min(r-this.pos,o-i);if(s!==r)n.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=me(e);for(;r<=o-i;i+=r)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){so.exists(this),so.output(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:o}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let u=i;u<r;u++)t[u]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),a=Number(n&i),l=r?4:0,c=r?0:4;e.setUint32(t+l,s,r),e.setUint32(t+c,a,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const s=me(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)s.setUint32(4*u,c[u],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:o,destroyed:i,pos:s}=this;return e.length=r,e.pos=s,e.finished=o,e.destroyed=i,r%t&&e.buffer.set(n),e}}const lo=(e,t,n)=>e&t^e&n^t&n,co=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),uo=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ho=new Uint32Array(64);class fo extends ao{constructor(){super(64,32,8,!1),this.A=0|uo[0],this.B=0|uo[1],this.C=0|uo[2],this.D=0|uo[3],this.E=0|uo[4],this.F=0|uo[5],this.G=0|uo[6],this.H=0|uo[7]}get(){const{A:e,B:t,C:n,D:r,E:o,F:i,G:s,H:a}=this;return[e,t,n,r,o,i,s,a]}set(e,t,n,r,o,i,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(e,t){for(let d=0;d<16;d++,t+=4)ho[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const e=ho[d-15],t=ho[d-2],n=we(e,7)^we(e,18)^e>>>3,r=we(t,17)^we(t,19)^t>>>10;ho[d]=r+ho[d-7]+n+ho[d-16]|0}let{A:n,B:r,C:o,D:i,E:s,F:a,G:l,H:c}=this;for(let d=0;d<64;d++){const e=c+(we(s,6)^we(s,11)^we(s,25))+((u=s)&a^~u&l)+co[d]+ho[d]|0,t=(we(n,2)^we(n,13)^we(n,22))+lo(n,r,o)|0;c=l,l=a,a=s,s=i+e|0,i=o,o=r,r=n,n=e+t|0}var u;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(n,r,o,i,s,a,l,c)}roundClean(){ho.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class po extends fo{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const go=Se((()=>new fo));Se((()=>new po));var yo=Symbol("verified"),mo=e=>e instanceof Object;new TextDecoder("utf-8");var wo=new TextEncoder;function bo(e){if(!function(e){if(!mo(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function vo(e){return ve(go(wo.encode(bo(e))))}var Eo=new class{generateSecretKey(){return ro.utils.randomPrivateKey()}getPublicKey(e){return ve(ro.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=ve(ro.getPublicKey(t)),n.id=vo(n),n.sig=ve(ro.sign(vo(n),t)),n[yo]=!0,n}verifyEvent(e){if("boolean"==typeof e[yo])return e[yo];const t=vo(e);if(t!==e.id)return e[yo]=!1,!1;try{const n=ro.verify(e.sig,t,e.pubkey);return e[yo]=n,n}catch(n){return e[yo]=!1,!1}}},xo=Eo.generateSecretKey,ko=Eo.getPublicKey,Ao=Eo.finalizeEvent;Eo.verifyEvent;var So=Symbol("verified"),zo=e=>e instanceof Object;new TextDecoder("utf-8");var To=new TextEncoder;var Io=class{constructor(e){t(this,"value"),t(this,"next",null),t(this,"prev",null),this.value=e}},_o=class{constructor(){t(this,"first"),t(this,"last"),this.first=null,this.last=null}enqueue(e){const t=new Io(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const e=this.first;return this.first=e.next,e.value}};function Co(e){if(!function(e){if(!zo(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Oo(e){return ve(go(To.encode(Co(e))))}var Lo=new class{generateSecretKey(){return ro.utils.randomPrivateKey()}getPublicKey(e){return ve(ro.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=ve(ro.getPublicKey(t)),n.id=Oo(n),n.sig=ve(ro.sign(Oo(n),t)),n[So]=!0,n}verifyEvent(e){if("boolean"==typeof e[So])return e[So];const t=Oo(e);if(t!==e.id)return e[So]=!1,!1;try{const n=ro.verify(e.sig,t,e.pubkey);return e[So]=n,n}catch(n){return e[So]=!1,!1}}};Lo.generateSecretKey,Lo.getPublicKey,Lo.finalizeEvent;var Bo=Lo.verifyEvent;function $o(e,t){if(e.ids&&-1===e.ids.indexOf(t.id))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since)&&!(e.until&&t.created_at>e.until)}async function Po(){return new Promise((e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()}))}var Ro,Uo=class{constructor(e,n){t(this,"url"),t(this,"_connected",!1),t(this,"onclose",null),t(this,"onnotice",(e=>console.debug(`NOTICE from ${this.url}: ${e}`))),t(this,"_onauth",null),t(this,"baseEoseTimeout",4400),t(this,"connectionTimeout",4400),t(this,"openSubs",new Map),t(this,"connectionTimeoutHandle"),t(this,"connectionPromise"),t(this,"openCountRequests",new Map),t(this,"openEventPublishes",new Map),t(this,"ws"),t(this,"incomingMessageQueue",new _o),t(this,"queueRunning",!1),t(this,"challenge"),t(this,"serial",0),t(this,"verifyEvent"),t(this,"_WebSocket"),this.url=function(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}(e),this.verifyEvent=n.verifyEvent,this._WebSocket=n.websocketImplementation||WebSocket}static async connect(e,t){const n=new Uo(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((e,t)=>{this.connectionTimeoutHandle=setTimeout((()=>{var e;t("connection timed out"),this.connectionPromise=void 0,null==(e=this.onclose)||e.call(this),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void t(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=e=>{var n;t(e.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,null==(n=this.onclose)||n.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var e;this._connected&&(this._connected=!1,this.connectionPromise=void 0,null==(e=this.onclose)||e.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await Po();this.queueRunning=!1}handleNext(){var e,t,n;const r=this.incomingMessageQueue.dequeue();if(!r)return!1;const o=function(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let n=e.slice(t+7+1).indexOf('"');if(-1===n)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(-1===o)return null;let i=r+1+o;return e.slice(r+1,i)}(r);if(o){const n=this.openSubs.get(o);if(!n)return;const i=function(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}(r,"id"),s=null==(e=n.alreadyHaveEvent)?void 0:e.call(n,i);if(null==(t=n.receivedEvent)||t.call(n,this,i),s)return}try{let e=JSON.parse(r);switch(e[0]){case"EVENT":{const t=this.openSubs.get(e[1]),n=e[2];return void(this.verifyEvent(n)&&function(e,t){for(let n=0;n<e.length;n++)if($o(e[n],t))return!0;return!1}(t.filters,n)&&t.onevent(n))}case"COUNT":{const t=e[1],n=e[2],r=this.openCountRequests.get(t);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(t)))}case"EOSE":{const t=this.openSubs.get(e[1]);if(!t)return;return void t.receivedEose()}case"OK":{const t=e[1],n=e[2],r=e[3],o=this.openEventPublishes.get(t);return n?o.resolve(r):o.reject(new Error(r)),void this.openEventPublishes.delete(t)}case"CLOSED":{const t=e[1],n=this.openSubs.get(t);if(!n)return;return n.closed=!0,void n.close(e[2])}case"NOTICE":return void this.onnotice(e[1]);case"AUTH":return this.challenge=e[1],void(null==(n=this._onauth)||n.call(this,e[1]))}}catch(i){return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{var t;null==(t=this.ws)||t.send(e)}))}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e((n=this.url,r=this.challenge,{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",n],["challenge",r]],content:""}));var n,r;const o=new Promise(((e,n)=>{this.openEventPublishes.set(t.id,{resolve:e,reject:n})}));return this.send('["AUTH",'+JSON.stringify(t)+"]"),o}async publish(e){const t=new Promise(((t,n)=>{this.openEventPublishes.set(e.id,{resolve:t,reject:n})}));return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const n=(null==t?void 0:t.id)||"count:"+this.serial,r=new Promise(((e,t)=>{this.openCountRequests.set(n,{resolve:e,reject:t})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new No(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,null==(e=this.ws)||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},No=class{constructor(e,n,r,o){t(this,"relay"),t(this,"id"),t(this,"closed",!1),t(this,"eosed",!1),t(this,"filters"),t(this,"alreadyHaveEvent"),t(this,"receivedEvent"),t(this,"onevent"),t(this,"oneose"),t(this,"onclose"),t(this,"eoseTimeout"),t(this,"eoseTimeoutHandle"),this.relay=e,this.filters=r,this.id=n,this.alreadyHaveEvent=o.alreadyHaveEvent,this.receivedEvent=o.receivedEvent,this.eoseTimeout=o.eoseTimeout||e.baseEoseTimeout,this.oneose=o.oneose,this.onclose=o.onclose,this.onevent=o.onevent||(e=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,e)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,null==(e=this.oneose)||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),null==(t=this.onclose)||t.call(this,e)}};try{Ro=WebSocket}catch{}var jo=class extends Uo{constructor(e){super(e,{verifyEvent:Bo,websocketImplementation:Ro})}static async connect(e){const t=new jo(e);return await t.connect(),t}};function Ho(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Mo(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function Do(e,...t){if(!((n=e)instanceof Uint8Array||null!=n&&"object"==typeof n&&"Uint8Array"===n.constructor.name))throw new Error("Uint8Array expected");var n;if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}
/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */new TextDecoder("utf-8"),new TextEncoder;const qo=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const Vo=(e,t)=>(Object.assign(t,e),t),Fo=16,Ko=283;function Wo(e){return e<<1^Ko&-(e>>7)}function Zo(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(1&t),e=Wo(e);return n}const Jo=(()=>{let e=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=Wo(r))e[n]=r;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return t})(),Go=Jo.map(((e,t)=>Jo.indexOf(t))),Yo=e=>e<<24|e>>>8,Qo=e=>e<<8|e>>>24;function Xo(e,t){if(256!==e.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>t(e[r]))),r=n.map(Qo),o=r.map(Qo),i=o.map(Qo),s=new Uint32Array(65536),a=new Uint32Array(65536),l=new Uint16Array(65536);for(let c=0;c<256;c++)for(let t=0;t<256;t++){const u=256*c+t;s[u]=n[c]^r[t],a[u]=o[c]^i[t],l[u]=e[c]<<8|e[t]}return{sbox:e,sbox2:l,T0:n,T1:r,T2:o,T3:i,T01:s,T23:a}}const ei=Xo(Jo,(e=>Zo(e,3)<<24|e<<16|e<<8|Zo(e,2))),ti=Xo(Go,(e=>Zo(e,11)<<24|Zo(e,13)<<16|Zo(e,9)<<8|Zo(e,14))),ni=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=Wo(n))e[t]=n;return e})();function ri(e){Do(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=ei,r=qo(e),o=r.length,i=e=>ii(n,e,e,e,e),s=new Uint32Array(t+28);s.set(r);for(let a=o;a<s.length;a++){let e=s[a-1];a%o==0?e=i(Yo(e))^ni[a/o-1]:o>6&&a%o==4&&(e=i(e)),s[a]=s[a-o]^e}return s}function oi(e,t,n,r,o,i){return e[n<<8&65280|r>>>8&255]^t[o>>>8&65280|i>>>24&255]}function ii(e,t,n,r,o){return e[255&t|65280&n]|e[r>>>16&255|o>>>16&65280]<<16}function si(e,t,n,r,o){const{sbox2:i,T01:s,T23:a}=ei;let l=0;t^=e[l++],n^=e[l++],r^=e[l++],o^=e[l++];const c=e.length/4-2;for(let u=0;u<c;u++){const i=e[l++]^oi(s,a,t,n,r,o),c=e[l++]^oi(s,a,n,r,o,t),u=e[l++]^oi(s,a,r,o,t,n),d=e[l++]^oi(s,a,o,t,n,r);t=i,n=c,r=u,o=d}return{s0:e[l++]^ii(i,t,n,r,o),s1:e[l++]^ii(i,n,r,o,t),s2:e[l++]^ii(i,r,o,t,n),s3:e[l++]^ii(i,o,t,n,r)}}function ai(e,t,n,r,o){const{sbox2:i,T01:s,T23:a}=ti;let l=0;t^=e[l++],n^=e[l++],r^=e[l++],o^=e[l++];const c=e.length/4-2;for(let u=0;u<c;u++){const i=e[l++]^oi(s,a,t,o,r,n),c=e[l++]^oi(s,a,n,t,o,r),u=e[l++]^oi(s,a,r,n,t,o),d=e[l++]^oi(s,a,o,r,n,t);t=i,n=c,r=u,o=d}return{s0:e[l++]^ii(i,t,o,r,n),s1:e[l++]^ii(i,n,t,o,r),s2:e[l++]^ii(i,r,n,t,o),s3:e[l++]^ii(i,o,r,n,t)}}function li(e,t){if(!t)return new Uint8Array(e);if(Do(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}const ci=Vo({blockSize:16,nonceLength:16},(function(e,t,n={}){Do(e),Do(t,16);const r=!n.disablePadding;return{encrypt:(n,o)=>{const i=ri(e),{b:s,o:a,out:l}=function(e,t,n){let r=e.length;const o=r%Fo;if(!t&&0!==o)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const i=qo(e);if(t){let e=Fo-o;e||(e=Fo),r+=e}const s=li(r,n);return{b:i,o:qo(s),out:s}}(n,r,o),c=qo(t);let u=c[0],d=c[1],h=c[2],f=c[3],p=0;for(;p+4<=s.length;)u^=s[p+0],d^=s[p+1],h^=s[p+2],f^=s[p+3],({s0:u,s1:d,s2:h,s3:f}=si(i,u,d,h,f)),a[p++]=u,a[p++]=d,a[p++]=h,a[p++]=f;if(r){const e=function(e){const t=new Uint8Array(16),n=qo(t);t.set(e);const r=Fo-e.length;for(let o=Fo-r;o<Fo;o++)t[o]=r;return n}(n.subarray(4*p));u^=e[0],d^=e[1],h^=e[2],f^=e[3],({s0:u,s1:d,s2:h,s3:f}=si(i,u,d,h,f)),a[p++]=u,a[p++]=d,a[p++]=h,a[p++]=f}return i.fill(0),l},decrypt:(n,o)=>{!function(e){if(Do(e),e.length%Fo!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}(n);const i=function(e){const t=ri(e),n=t.slice(),r=t.length,{sbox2:o}=ei,{T0:i,T1:s,T2:a,T3:l}=ti;for(let c=0;c<r;c+=4)for(let e=0;e<4;e++)n[c+e]=t[r-c-4+e];t.fill(0);for(let c=4;c<r-4;c++){const e=n[c],t=ii(o,e,e,e,e);n[c]=i[255&t]^s[t>>>8&255]^a[t>>>16&255]^l[t>>>24]}return n}(e),s=qo(t),a=li(n.length,o),l=qo(n),c=qo(a);let u=s[0],d=s[1],h=s[2],f=s[3];for(let e=0;e+4<=l.length;){const t=u,n=d,r=h,o=f;u=l[e+0],d=l[e+1],h=l[e+2],f=l[e+3];const{s0:s,s1:a,s2:p,s3:g}=ai(i,u,d,h,f);c[e++]=s^t,c[e++]=a^n,c[e++]=p^r,c[e++]=g^o}return i.fill(0),function(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const o=e.subarray(0,-r);for(let i=0;i<r;i++)if(e[n-i-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}(a,r)}}})),ui=e=>Uint8Array.from(e.split("").map((e=>e.charCodeAt(0)))),di=ui("expand 16-byte k"),hi=ui("expand 32-byte k"),fi=qo(di),pi=qo(hi);function gi(e,t){return e<<t|e>>>32-t}function yi(e){return e.byteOffset%4==0}pi.slice();const mi=64,wi=16,bi=2**32-1,vi=new Uint32Array;function Ei(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:i,rounds:s}=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw new Error("core must be a function");return Ho(o),Ho(s),Mo(i),Mo(n),(t,a,l,c,u=0)=>{Do(t),Do(a),Do(l);const d=l.length;if(c||(c=new Uint8Array(d)),Do(c),Ho(u),u<0||u>=bi)throw new Error("arx: counter overflow");if(c.length<d)throw new Error(`arx: output (${c.length}) is shorter than data (${d})`);const h=[];let f,p,g=t.length;if(32===g)f=t.slice(),h.push(f),p=pi;else{if(16!==g||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);f=new Uint8Array(32),f.set(t),f.set(t,16),p=fi,h.push(f)}yi(a)||(a=a.slice(),h.push(a));const y=qo(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,y,qo(a.subarray(0,16)),y),a=a.subarray(16)}const m=16-o;if(m!==a.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(12!==m){const e=new Uint8Array(12);e.set(a,i?0:12-a.length),a=e,h.push(a)}const w=qo(a);for(!function(e,t,n,r,o,i,s,a){const l=o.length,c=new Uint8Array(mi),u=qo(c),d=yi(o)&&yi(i),h=d?qo(o):vi,f=d?qo(i):vi;for(let p=0;p<l;s++){if(e(t,n,r,u,s,a),s>=bi)throw new Error("arx: counter overflow");const g=Math.min(mi,l-p);if(d&&g===mi){const e=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let t,n=0;n<wi;n++)t=e+n,f[t]=h[t]^u[n];p+=mi}else{for(let e,t=0;t<g;t++)e=p+t,i[e]=o[e]^c[t];p+=g}}}(e,p,y,w,l,c,u,s);h.length>0;)h.pop().fill(0);return c}}function xi(e,t,n,r,o,i=20){let s=e[0],a=e[1],l=e[2],c=e[3],u=t[0],d=t[1],h=t[2],f=t[3],p=t[4],g=t[5],y=t[6],m=t[7],w=o,b=n[0],v=n[1],E=n[2],x=s,k=a,A=l,S=c,z=u,T=d,I=h,_=f,C=p,O=g,L=y,B=m,$=w,P=b,R=v,U=E;for(let j=0;j<i;j+=2)x=x+z|0,$=gi($^x,16),C=C+$|0,z=gi(z^C,12),x=x+z|0,$=gi($^x,8),C=C+$|0,z=gi(z^C,7),k=k+T|0,P=gi(P^k,16),O=O+P|0,T=gi(T^O,12),k=k+T|0,P=gi(P^k,8),O=O+P|0,T=gi(T^O,7),A=A+I|0,R=gi(R^A,16),L=L+R|0,I=gi(I^L,12),A=A+I|0,R=gi(R^A,8),L=L+R|0,I=gi(I^L,7),S=S+_|0,U=gi(U^S,16),B=B+U|0,_=gi(_^B,12),S=S+_|0,U=gi(U^S,8),B=B+U|0,_=gi(_^B,7),x=x+T|0,U=gi(U^x,16),L=L+U|0,T=gi(T^L,12),x=x+T|0,U=gi(U^x,8),L=L+U|0,T=gi(T^L,7),k=k+I|0,$=gi($^k,16),B=B+$|0,I=gi(I^B,12),k=k+I|0,$=gi($^k,8),B=B+$|0,I=gi(I^B,7),A=A+_|0,P=gi(P^A,16),C=C+P|0,_=gi(_^C,12),A=A+_|0,P=gi(P^A,8),C=C+P|0,_=gi(_^C,7),S=S+z|0,R=gi(R^S,16),O=O+R|0,z=gi(z^O,12),S=S+z|0,R=gi(R^S,8),O=O+R|0,z=gi(z^O,7);let N=0;r[N++]=s+x|0,r[N++]=a+k|0,r[N++]=l+A|0,r[N++]=c+S|0,r[N++]=u+z|0,r[N++]=d+T|0,r[N++]=h+I|0,r[N++]=f+_|0,r[N++]=p+C|0,r[N++]=g+O|0,r[N++]=y+L|0,r[N++]=m+B|0,r[N++]=w+$|0,r[N++]=b+P|0,r[N++]=v+R|0,r[N++]=E+U|0}const ki=Ei(xi,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Ai extends Ae{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,so.hash(e);const n=xe(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?e.create().update(n).digest():n);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=e.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),o.fill(0)}update(e){return so.exists(this),this.iHash.update(e),this}digestInto(e){so.exists(this),so.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:o,blockLen:i,outputLen:s}=this;return e.finished=r,e.destroyed=o,e.blockLen=i,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Si=(e,t,n)=>new Ai(e,t).update(n).digest();Si.create=(e,t)=>new Ai(e,t);const zi=new Uint8Array([0]),Ti=new Uint8Array;var Ii=Object.defineProperty,_i=(e,t)=>{for(var n in t)Ii(e,n,{get:t[n],enumerable:!0})},Ci=Symbol("verified"),Oi=e=>e instanceof Object;function Li(e){if(!Oi(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}_i({},{Queue:()=>Hi,QueueNode:()=>ji,binarySearch:()=>Ni,insertEventIntoAscendingList:()=>Ui,insertEventIntoDescendingList:()=>Ri,normalizeURL:()=>Pi,utf8Decoder:()=>Bi,utf8Encoder:()=>$i});var Bi=new TextDecoder("utf-8"),$i=new TextEncoder;function Pi(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function Ri(e,t){const[n,r]=Ni(e,(e=>t.id===e.id?0:t.created_at===e.created_at?-1:e.created_at-t.created_at));return r||e.splice(n,0,t),e}function Ui(e,t){const[n,r]=Ni(e,(e=>t.id===e.id?0:t.created_at===e.created_at?-1:t.created_at-e.created_at));return r||e.splice(n,0,t),e}function Ni(e,t){let n=0,r=e.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),i=t(e[o]);if(0===i)return[o,!0];i<0?r=o-1:n=o+1}return[n,!1]}var ji=class{constructor(e){t(this,"value"),t(this,"next",null),t(this,"prev",null),this.value=e}},Hi=class{constructor(){t(this,"first"),t(this,"last"),this.first=null,this.last=null}enqueue(e){const t=new ji(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const e=this.first;return this.first=e.next,e.value}};function Mi(e){return ve(go($i.encode(function(e){if(!Li(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}(e))))}var Di=new class{generateSecretKey(){return ro.utils.randomPrivateKey()}getPublicKey(e){return ve(ro.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=ve(ro.getPublicKey(t)),n.id=Mi(n),n.sig=ve(ro.sign(Mi(n),t)),n[Ci]=!0,n}verifyEvent(e){if("boolean"==typeof e[Ci])return e[Ci];const t=Mi(e);if(t!==e.id)return e[Ci]=!1,!1;try{const n=ro.verify(e.sig,t,e.pubkey);return e[Ci]=n,n}catch(n){return e[Ci]=!1,!1}}};Di.generateSecretKey,Di.getPublicKey;var qi=Di.finalizeEvent,Vi=Di.verifyEvent;function Fi(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Ki(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function Wi(e){return 2e4<=e&&e<3e4}function Zi(e){return 3e4<=e&&e<4e4}function Ji(e){return Fi(e)?"regular":Ki(e)?"replaceable":Wi(e)?"ephemeral":Zi(e)?"parameterized":"unknown"}_i({},{Application:()=>oa,BadgeAward:()=>is,BadgeDefinition:()=>Ys,BlockedRelaysList:()=>Bs,BookmarkList:()=>Cs,Bookmarksets:()=>Zs,Calendar:()=>da,CalendarEventRSVP:()=>ha,ChannelCreation:()=>as,ChannelHideMessage:()=>us,ChannelMessage:()=>cs,ChannelMetadata:()=>ls,ChannelMuteUser:()=>ds,ClassifiedListing:()=>aa,ClientAuth:()=>Hs,CommunitiesList:()=>Os,CommunityDefinition:()=>ga,CommunityPostApproval:()=>bs,Contacts:()=>Xi,CreateOrUpdateProduct:()=>ea,CreateOrUpdateStall:()=>Xs,Curationsets:()=>Js,Date:()=>ca,DraftClassifiedListing:()=>la,DraftLong:()=>na,Emojisets:()=>ra,EncryptedDirectMessage:()=>es,EncryptedDirectMessages:()=>ts,EventDeletion:()=>ns,FileMetadata:()=>fs,FileServerPreference:()=>Us,Followsets:()=>Fs,GenericRepost:()=>ss,Genericlists:()=>Ks,HTTPAuth:()=>Vs,Handlerinformation:()=>pa,Handlerrecommendation:()=>fa,Highlights:()=>zs,InterestsList:()=>Ps,Interestsets:()=>Qs,JobFeedback:()=>xs,JobRequest:()=>vs,JobResult:()=>Es,Label:()=>ws,LightningPubRPC:()=>js,LiveChatMessage:()=>ps,LiveEvent:()=>ia,LongFormArticle:()=>ta,Metadata:()=>Gi,Mutelist:()=>Ts,NWCWalletInfo:()=>Ns,NWCWalletRequest:()=>Ms,NWCWalletResponse:()=>Ds,NostrConnect:()=>qs,OpenTimestamps:()=>hs,Pinlist:()=>Is,ProblemTracker:()=>gs,ProfileBadges:()=>Gs,PublicChatsList:()=>Ls,Reaction:()=>os,RecommendRelay:()=>Qi,RelayList:()=>_s,Relaysets:()=>Ws,Report:()=>ys,Reporting:()=>ms,Repost:()=>rs,SearchRelaysList:()=>$s,ShortTextNote:()=>Yi,Time:()=>ua,UserEmojiList:()=>Rs,UserStatuses:()=>sa,Zap:()=>Ss,ZapGoal:()=>ks,ZapRequest:()=>As,classifyKind:()=>Ji,isEphemeralKind:()=>Wi,isParameterizedReplaceableKind:()=>Zi,isRegularKind:()=>Fi,isReplaceableKind:()=>Ki});var Gi=0,Yi=1,Qi=2,Xi=3,es=4,ts=4,ns=5,rs=6,os=7,is=8,ss=16,as=40,ls=41,cs=42,us=43,ds=44,hs=1040,fs=1063,ps=1311,gs=1971,ys=1984,ms=1984,ws=1985,bs=4550,vs=5999,Es=6999,xs=7e3,ks=9041,As=9734,Ss=9735,zs=9802,Ts=1e4,Is=10001,_s=10002,Cs=10003,Os=10004,Ls=10005,Bs=10006,$s=10007,Ps=10015,Rs=10030,Us=10096,Ns=13194,js=21e3,Hs=22242,Ms=23194,Ds=23195,qs=24133,Vs=27235,Fs=3e4,Ks=30001,Ws=30002,Zs=30003,Js=30004,Gs=30008,Ys=30009,Qs=30015,Xs=30017,ea=30018,ta=30023,na=30024,ra=30030,oa=30078,ia=30311,sa=30315,aa=30402,la=30403,ca=31922,ua=31923,da=31924,ha=31925,fa=31989,pa=31990,ga=34550;function ya(e,t){if(e.ids&&-1===e.ids.indexOf(t.id))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since)&&!(e.until&&t.created_at>e.until)}function ma(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}function wa(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,o=e.slice(r),i=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,i),10)}function ba(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let n=e.slice(t+7+1).indexOf('"');if(-1===n)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(-1===o)return null;let i=r+1+o;return e.slice(r+1,i)}function va(e,t){return t===ma(e,"id")}function Ea(e,t){return t===ma(e,"pubkey")}function xa(e,t){return t===wa(e,"kind")}_i({},{getHex64:()=>ma,getInt:()=>wa,getSubscriptionId:()=>ba,matchEventId:()=>va,matchEventKind:()=>xa,matchEventPubkey:()=>Ea});function ka(e,t){return{kind:Hs,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function Aa(){return new Promise((e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()}))}_i({},{makeAuthEvent:()=>ka});var Sa=e=>(e[Ci]=!0,!0),za=class{constructor(e,n){t(this,"url"),t(this,"_connected",!1),t(this,"onclose",null),t(this,"onnotice",(e=>console.debug(`NOTICE from ${this.url}: ${e}`))),t(this,"_onauth",null),t(this,"baseEoseTimeout",4400),t(this,"connectionTimeout",4400),t(this,"openSubs",new Map),t(this,"connectionTimeoutHandle"),t(this,"connectionPromise"),t(this,"openCountRequests",new Map),t(this,"openEventPublishes",new Map),t(this,"ws"),t(this,"incomingMessageQueue",new Hi),t(this,"queueRunning",!1),t(this,"challenge"),t(this,"serial",0),t(this,"verifyEvent"),t(this,"_WebSocket"),this.url=Pi(e),this.verifyEvent=n.verifyEvent,this._WebSocket=n.websocketImplementation||WebSocket}static async connect(e,t){const n=new za(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((e,t)=>{this.connectionTimeoutHandle=setTimeout((()=>{var e;t("connection timed out"),this.connectionPromise=void 0,null==(e=this.onclose)||e.call(this),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void t(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=e=>{var n;t(e.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,null==(n=this.onclose)||n.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var e;this._connected&&(this._connected=!1,this.connectionPromise=void 0,null==(e=this.onclose)||e.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await Aa();this.queueRunning=!1}handleNext(){var e,t,n;const r=this.incomingMessageQueue.dequeue();if(!r)return!1;const o=ba(r);if(o){const n=this.openSubs.get(o);if(!n)return;const i=ma(r,"id"),s=null==(e=n.alreadyHaveEvent)?void 0:e.call(n,i);if(null==(t=n.receivedEvent)||t.call(n,this,i),s)return}try{let e=JSON.parse(r);switch(e[0]){case"EVENT":{const t=this.openSubs.get(e[1]),n=e[2];return void(this.verifyEvent(n)&&function(e,t){for(let n=0;n<e.length;n++)if(ya(e[n],t))return!0;return!1}(t.filters,n)&&t.onevent(n))}case"COUNT":{const t=e[1],n=e[2],r=this.openCountRequests.get(t);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(t)))}case"EOSE":{const t=this.openSubs.get(e[1]);if(!t)return;return void t.receivedEose()}case"OK":{const t=e[1],n=e[2],r=e[3],o=this.openEventPublishes.get(t);return n?o.resolve(r):o.reject(new Error(r)),void this.openEventPublishes.delete(t)}case"CLOSED":{const t=e[1],n=this.openSubs.get(t);if(!n)return;return n.closed=!0,void n.close(e[2])}case"NOTICE":return void this.onnotice(e[1]);case"AUTH":return this.challenge=e[1],void(null==(n=this._onauth)||n.call(this,e[1]))}}catch(i){return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{var t;null==(t=this.ws)||t.send(e)}))}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e(ka(this.url,this.challenge)),n=new Promise(((e,n)=>{this.openEventPublishes.set(t.id,{resolve:e,reject:n})}));return this.send('["AUTH",'+JSON.stringify(t)+"]"),n}async publish(e){const t=new Promise(((t,n)=>{this.openEventPublishes.set(e.id,{resolve:t,reject:n})}));return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const n=(null==t?void 0:t.id)||"count:"+this.serial,r=new Promise(((e,t)=>{this.openCountRequests.set(n,{resolve:e,reject:t})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new Ta(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,null==(e=this.ws)||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Ta=class{constructor(e,n,r,o){t(this,"relay"),t(this,"id"),t(this,"closed",!1),t(this,"eosed",!1),t(this,"filters"),t(this,"alreadyHaveEvent"),t(this,"receivedEvent"),t(this,"onevent"),t(this,"oneose"),t(this,"onclose"),t(this,"eoseTimeout"),t(this,"eoseTimeoutHandle"),this.relay=e,this.filters=r,this.id=n,this.alreadyHaveEvent=o.alreadyHaveEvent,this.receivedEvent=o.receivedEvent,this.eoseTimeout=o.eoseTimeout||e.baseEoseTimeout,this.oneose=o.oneose,this.onclose=o.onclose,this.onevent=o.onevent||(e=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,e)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,null==(e=this.oneose)||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),null==(t=this.onclose)||t.call(this,e)}};try{WebSocket}catch{}var Ia,_a=class{constructor(e){t(this,"relays",new Map),t(this,"seenOn",new Map),t(this,"trackRelays",!1),t(this,"verifyEvent"),t(this,"trustedRelayURLs",new Set),t(this,"_WebSocket"),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation}async ensureRelay(e,t){e=Pi(e);let n=this.relays.get(e);return n||(n=new za(e,{verifyEvent:this.trustedRelayURLs.has(e)?Sa:this.verifyEvent,websocketImplementation:this._WebSocket}),(null==t?void 0:t.connectionTimeout)&&(n.connectionTimeout=t.connectionTimeout),this.relays.set(e,n)),await n.connect(),n}close(e){e.map(Pi).forEach((e=>{var t;null==(t=this.relays.get(e))||t.close()}))}subscribeMany(e,t,n){return this.subscribeManyMap(Object.fromEntries(e.map((e=>[e,t]))),n)}subscribeManyMap(e,t){this.trackRelays&&(t.receivedEvent=(e,t)=>{let n=this.seenOn.get(t);n||(n=new Set,this.seenOn.set(t,n)),n.add(e)});const n=new Set,r=[],o=Object.keys(e).length,i=[];let s=e=>{var n;i[e]=!0,i.filter((e=>e)).length===o&&(null==(n=t.oneose)||n.call(t),s=()=>{})};const a=[];let l=(e,n)=>{var r;s(e),a[e]=n,a.filter((e=>e)).length===o&&(null==(r=t.onclose)||r.call(t,a),l=()=>{})};const c=e=>{var r;if(null==(r=t.alreadyHaveEvent)?void 0:r.call(t,e))return!0;const o=n.has(e);return n.add(e),o},u=Promise.all(Object.entries(e).map((async(e,n,o)=>{if(o.indexOf(e)!==n)return void l(n,"duplicate url");let i,[a,u]=e;a=Pi(a);try{i=await this.ensureRelay(a,{connectionTimeout:t.maxWait?Math.max(.8*t.maxWait,t.maxWait-1e3):void 0})}catch(h){return void l(n,(null==h?void 0:h.message)||String(h))}let d=i.subscribe(u,{...t,oneose:()=>s(n),onclose:e=>l(n,e),alreadyHaveEvent:c,eoseTimeout:t.maxWait});r.push(d)})));return{async close(){await u,r.forEach((e=>{e.close()}))}}}subscribeManyEose(e,t,n){const r=this.subscribeMany(e,t,{...n,oneose(){r.close()}});return r}async querySync(e,t,n){return new Promise((async r=>{const o=[];this.subscribeManyEose(e,[t],{...n,onevent(e){o.push(e)},onclose(e){r(o)}})}))}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort(((e,t)=>t.created_at-e.created_at)),r[0]||null}publish(e,t){return e.map(Pi).map((async(e,n,r)=>{if(r.indexOf(e)!==n)return Promise.reject("duplicate url");return(await this.ensureRelay(e)).publish(t)}))}};try{Ia=WebSocket}catch{}var Ca=class extends _a{constructor(){super({verifyEvent:Vi,websocketImplementation:Ia})}};_i({},{BECH32_REGEX:()=>La,Bech32MaxSize:()=>Oa,decode:()=>Ba,encodeBytes:()=>ja,naddrEncode:()=>Da,neventEncode:()=>Ma,noteEncode:()=>Ua,nprofileEncode:()=>Ha,npubEncode:()=>Ra,nrelayEncode:()=>qa,nsecEncode:()=>Pa});var Oa=5e3,La=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Ba(e){var t,n,r,o,i,s,a,l;let{prefix:c,words:u}=Ie.bech32.decode(e,Oa),d=new Uint8Array(Ie.bech32.fromWords(u));switch(c){case"nprofile":{let e=$a(d);if(!(null==(t=e[0])?void 0:t[0]))throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ve(e[0][0]),relays:e[1]?e[1].map((e=>Bi.decode(e))):[]}}}case"nevent":{let e=$a(d);if(!(null==(n=e[0])?void 0:n[0]))throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ve(e[0][0]),relays:e[1]?e[1].map((e=>Bi.decode(e))):[],author:(null==(r=e[2])?void 0:r[0])?ve(e[2][0]):void 0,kind:(null==(o=e[3])?void 0:o[0])?parseInt(ve(e[3][0]),16):void 0}}}case"naddr":{let e=$a(d);if(!(null==(i=e[0])?void 0:i[0]))throw new Error("missing TLV 0 for naddr");if(!(null==(s=e[2])?void 0:s[0]))throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!(null==(a=e[3])?void 0:a[0]))throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Bi.decode(e[0][0]),pubkey:ve(e[2][0]),kind:parseInt(ve(e[3][0]),16),relays:e[1]?e[1].map((e=>Bi.decode(e))):[]}}}case"nrelay":{let e=$a(d);if(!(null==(l=e[0])?void 0:l[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Bi.decode(e[0][0])}}case"nsec":return{type:c,data:d};case"npub":case"note":return{type:c,data:ve(d)};default:throw new Error(`unknown prefix ${c}`)}}function $a(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],o=n.slice(2,2+r);if(n=n.slice(2+r),o.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(o)}return t}function Pa(e){return ja("nsec",e)}function Ra(e){return ja("npub",Ee(e))}function Ua(e){return ja("note",Ee(e))}function Na(e,t){let n=Ie.bech32.toWords(t);return Ie.bech32.encode(e,n,Oa)}function ja(e,t){return Na(e,t)}function Ha(e){return Na("nprofile",Va({0:[Ee(e.pubkey)],1:(e.relays||[]).map((e=>$i.encode(e)))}))}function Ma(e){let t;return void 0!==e.kind&&(t=function(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=255&e,t}(e.kind)),Na("nevent",Va({0:[Ee(e.id)],1:(e.relays||[]).map((e=>$i.encode(e))),2:e.author?[Ee(e.author)]:[],3:t?[new Uint8Array(t)]:[]}))}function Da(e){let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e.kind,!1),Na("naddr",Va({0:[$i.encode(e.identifier)],1:(e.relays||[]).map((e=>$i.encode(e))),2:[Ee(e.pubkey)],3:[new Uint8Array(t)]}))}function qa(e){return Na("nrelay",Va({0:[$i.encode(e)]}))}function Va(e){let t=[];return Object.entries(e).reverse().forEach((([e,n])=>{n.forEach((n=>{let r=new Uint8Array(n.length+2);r.set([parseInt(e)],0),r.set([n.length],1),r.set(n,2),t.push(r)}))})),ke(...t)}var Fa={};async function Ka(e,t,n){const r=e instanceof Uint8Array?ve(e):e,o=Za(jr.getSharedSecret(r,"02"+t));let i=Uint8Array.from(ze(16)),s=$i.encode(n),a=ci(o,i).encrypt(s);return`${Ie.base64.encode(new Uint8Array(a))}?iv=${Ie.base64.encode(new Uint8Array(i.buffer))}`}async function Wa(e,t,n){const r=e instanceof Uint8Array?ve(e):e;let[o,i]=n.split("?iv="),s=Za(jr.getSharedSecret(r,"02"+t)),a=Ie.base64.decode(i),l=Ie.base64.decode(o),c=ci(s,a).decrypt(l);return Bi.decode(c)}function Za(e){return e.slice(1,33)}_i(Fa,{decrypt:()=>Wa,encrypt:()=>Ka});_i({},{NIP05_REGEX:()=>Ga,isValid:()=>el,queryProfile:()=>Xa,searchDomain:()=>Qa,useFetchImplementation:()=>Ya});var Ja,Ga=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/;try{Ja=fetch}catch{}function Ya(e){Ja=e}async function Qa(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await Ja(n,{redirect:"error"});return(await r.json()).names}catch(n){return{}}}async function Xa(e){var t;const n=e.match(Ga);if(!n)return null;const[r,o="_",i]=n;try{const e=`https://${i}/.well-known/nostr.json?name=${o}`,n=await(await Ja(e,{redirect:"error"})).json();let r=n.names[o];return r?{pubkey:r,relays:null==(t=n.relays)?void 0:t[r]}:null}catch(s){return null}}async function el(e,t){let n=await Xa(t);return!!n&&n.pubkey===e}function tl(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(const r of e.tags)"e"===r[0]&&r[1]&&n.push(r),"p"===r[0]&&r[1]&&t.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let r=0;r<n.length;r++){const e=n[r],[o,i,s,a]=e,l={id:i,relays:s?[s]:[]},c=0===r,u=r===n.length-1;"root"!==a?"reply"!==a?"mention"!==a?c?t.root=l:u?t.reply=l:t.mentions.push(l):t.mentions.push(l):t.reply=l:t.root=l}return t}_i({},{parse:()=>tl});_i({},{fetchRelayInformation:()=>rl,useFetchImplementation:()=>nl});try{fetch}catch{}function nl(e){e}async function rl(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}function ol(e){let t=0;for(let n=0;n<e.length;n++){const r=parseInt(e[n],16);if(0!==r){t+=Math.clz32(r)-28;break}t+=4}return t}function il(e,t){let n=0;const r=e,o=["nonce",n.toString(),t.toString()];for(r.tags.push(o);;){const e=Math.floor((new Date).getTime()/1e3);if(e!==r.created_at&&(n=0,r.created_at=e),o[1]=(++n).toString(),r.id=Mi(r),ol(r.id)>=t)break}return r}_i({},{getPow:()=>ol,minePow:()=>il});function sl(e,t,n,r){return qi({kind:rs,tags:[...e.tags??[],["e",t.id,n],["p",t.pubkey]],content:""===e.content?"":JSON.stringify(t),created_at:e.created_at},r)}function al(e){if(e.kind!==rs)return;let t,n;for(let r=e.tags.length-1;r>=0&&(void 0===t||void 0===n);r--){const o=e.tags[r];o.length>=2&&("e"===o[0]&&void 0===t?t=o:"p"===o[0]&&void 0===n&&(n=o))}return void 0!==t?{id:t[1],relays:[t[2],null==n?void 0:n[2]].filter((e=>"string"==typeof e)),author:null==n?void 0:n[1]}:void 0}function ll(e,{skipVerification:t}={}){const n=al(e);if(void 0===n||""===e.content)return;let r;try{r=JSON.parse(e.content)}catch(o){return}return r.id===n.id&&(t||Vi(r))?r:void 0}_i({},{finishRepostEvent:()=>sl,getRepostedEvent:()=>ll,getRepostedEventPointer:()=>al});_i({},{NOSTR_URI_REGEX:()=>cl,parse:()=>dl,test:()=>ul});var cl=new RegExp(`nostr:(${La.source})`);function ul(e){return"string"==typeof e&&new RegExp(`^${cl.source}$`).test(e)}function dl(e){const t=e.match(new RegExp(`^${cl.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:Ba(t[1])}}function hl(e,t,n){const r=t.tags.filter((e=>e.length>=2&&("e"===e[0]||"p"===e[0])));return qi({...e,kind:os,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function fl(e){if(e.kind!==os)return;let t,n;for(let r=e.tags.length-1;r>=0&&(void 0===t||void 0===n);r--){const o=e.tags[r];o.length>=2&&("e"===o[0]&&void 0===t?t=o:"p"===o[0]&&void 0===n&&(n=o))}return void 0!==t&&void 0!==n?{id:t[1],relays:[t[2],n[2]].filter((e=>void 0!==e)),author:n[1]}:void 0}_i({},{finishReactionEvent:()=>hl,getReactedEventPointer:()=>fl});_i({},{matchAll:()=>gl,regex:()=>pl,replaceAll:()=>yl});var pl=()=>new RegExp(`\\b${cl.source}\\b`,"g");function*gl(e){const t=e.matchAll(pl());for(const r of t)try{const[e,t]=r;yield{uri:e,value:t,decoded:Ba(t),start:r.index,end:r.index+e.length}}catch(n){}}function yl(e,t){return e.replaceAll(pl(),((e,n)=>t({uri:e,value:n,decoded:Ba(n)})))}_i({},{channelCreateEvent:()=>ml,channelHideMessageEvent:()=>vl,channelMessageEvent:()=>bl,channelMetadataEvent:()=>wl,channelMuteUserEvent:()=>El});var ml=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return qi({kind:as,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},wl=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return qi({kind:ls,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},bl=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),qi({kind:cs,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},vl=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return qi({kind:us,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},El=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return qi({kind:ds,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)};_i({},{EMOJI_SHORTCODE_REGEX:()=>xl,matchAll:()=>Al,regex:()=>kl,replaceAll:()=>Sl});var xl=/:(\w+):/,kl=()=>new RegExp(`\\B${xl.source}\\B`,"g");function*Al(e){const t=e.matchAll(kl());for(const r of t)try{const[e,t]=r;yield{shortcode:e,name:t,start:r.index,end:r.index+e.length}}catch(n){}}function Sl(e,t){return e.replaceAll(kl(),((e,n)=>t({shortcode:e,name:n})))}var zl;_i({},{useFetchImplementation:()=>Tl,validateGithub:()=>Il});try{zl=fetch}catch{}function Tl(e){zl=e}async function Il(e,t,n){try{return await(await zl(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch(r){return!1}}var _l={};_i(_l,{decrypt:()=>Nl,encrypt:()=>Ul,getConversationKey:()=>Ll,v2:()=>jl});var Cl=1,Ol=65535;function Ll(e,t){const n=jr.getSharedSecret(e,"02"+t).subarray(1,33);return r=go,o=n,i="nip44-v2",so.hash(r),void 0===i&&(i=new Uint8Array(r.outputLen)),Si(r,xe(i),xe(o));var r,o,i}function Bl(e,t){const n=function(e,t,n,r=32){if(so.hash(e),so.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/e.outputLen);void 0===n&&(n=Ti);const i=new Uint8Array(o*e.outputLen),s=Si.create(e,t),a=s._cloneInto(),l=new Uint8Array(s.outputLen);for(let c=0;c<o;c++)zi[0]=c+1,a.update(0===c?Ti:l).update(n).update(zi).digestInto(l),i.set(l,e.outputLen*c),s._cloneInto(a);return s.destroy(),a.destroy(),l.fill(0),zi.fill(0),i.slice(0,r)}(go,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function $l(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function Pl(e){const t=$i.encode(e),n=t.length;return ke(function(e){if(!Number.isSafeInteger(e)||e<Cl||e>Ol)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}(n),t,new Uint8Array($l(n)-n))}function Rl(e,t,n){if(32!==n.length)throw new Error("AAD associated data must be 32 bytes");const r=ke(n,t);return Si(go,e,r)}function Ul(e,t,n=ze(32)){const{chacha_key:r,chacha_nonce:o,hmac_key:i}=Bl(t,n),s=Pl(e),a=ki(r,o,s),l=Rl(i,a,n);return Ie.base64.encode(ke(new Uint8Array([2]),n,a,l))}function Nl(e,t){const{nonce:n,ciphertext:r,mac:o}=function(e){if("string"!=typeof e)throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if("#"===e[0])throw new Error("unknown encryption version");let n;try{n=Ie.base64.decode(e)}catch(i){throw new Error("invalid base64: "+i.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const o=n[0];if(2!==o)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}(e),{chacha_key:i,chacha_nonce:s,hmac_key:a}=Bl(t,n);if(!function(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n}(Rl(a,r,n),o))throw new Error("invalid MAC");return function(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<Cl||t>Ol||n.length!==t||e.length!==2+$l(t))throw new Error("invalid padding");return Bi.decode(n)}(ki(i,s,r))}var jl={utils:{getConversationKey:Ll,calcPaddedLen:$l},encrypt:Ul,decrypt:Nl};function Hl(e){const{pathname:t,searchParams:n}=new URL(e),r=t,o=n.get("relay"),i=n.get("secret");if(!r||!o||!i)throw new Error("invalid connection string");return{pubkey:r,relay:o,secret:i}}async function Ml(e,t,n){const r={method:"pay_invoice",params:{invoice:n}},o=await Ka(t,e,JSON.stringify(r)),i={kind:Ms,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e]]};return qi(i,t)}_i({},{makeNwcRequestEvent:()=>Ml,parseConnectionString:()=>Hl});var Dl;_i({},{getZapEndpoint:()=>Vl,makeZapReceipt:()=>Wl,makeZapRequest:()=>Fl,useFetchImplementation:()=>ql,validateZapRequest:()=>Kl});try{Dl=fetch}catch{}function ql(e){Dl=e}async function Vl(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:e}=Ie.bech32.decode(n,1e3),r=Ie.bech32.fromWords(e);t=Bi.decode(r)}else{if(!r)return null;{let[e,n]=r.split("@");t=new URL(`/.well-known/lnurlp/${e}`,`https://${n}`).toString()}}let o=await Dl(t),i=await o.json();if(i.allowsNostr&&i.nostrPubkey)return i.callback}catch(t){}return null}function Fl({profile:e,event:t,amount:n,relays:r,comment:o=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let i={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e],["amount",n.toString()],["relays",...r]]};return t&&i.tags.push(["e",t]),i}function Kl(e){let t;try{t=JSON.parse(e)}catch(o){return"Invalid zap request JSON."}if(!Li(t))return"Zap request is not a valid Nostr event.";if(!Vi(t))return"Invalid signature on zap request.";let n=t.tags.find((([e,t])=>"p"===e&&t));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find((([e,t])=>"e"===e&&t));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find((([e,t])=>"relays"===e&&t))?null:"Zap request doesn't have a 'relays' tag."}function Wl({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let o=JSON.parse(e),i=o.tags.filter((([e])=>"e"===e||"p"===e||"a"===e)),s={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...i,["P",o.pubkey],["bolt11",n],["description",e]]};return t&&s.tags.push(["preimage",t]),s}_i({},{getToken:()=>Jl,hashPayload:()=>nc,unpackEventFromToken:()=>Yl,validateEvent:()=>oc,validateEventKind:()=>Xl,validateEventMethodTag:()=>tc,validateEventPayloadTag:()=>rc,validateEventTimestamp:()=>Ql,validateEventUrlTag:()=>ec,validateToken:()=>Gl});var Zl="Nostr ";async function Jl(e,t,n,r=!1,o){const i={kind:Vs,tags:[["u",e],["method",t]],created_at:Math.round((new Date).getTime()/1e3),content:""};o&&i.tags.push(["payload",nc(o)]);const s=await n(i);return(r?Zl:"")+Ie.base64.encode($i.encode(JSON.stringify(s)))}async function Gl(e,t,n){const r=await Yl(e).catch((e=>{throw e}));return await oc(r,t,n).catch((e=>{throw e}))}async function Yl(e){if(!e)throw new Error("Missing token");e=e.replace(Zl,"");const t=Bi.decode(Ie.base64.decode(e));if(!t||0===t.length||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function Ql(e){return!!e.created_at&&Math.round((new Date).getTime()/1e3)-e.created_at<60}function Xl(e){return e.kind===Vs}function ec(e,t){const n=e.tags.find((e=>"u"===e[0]));return!!n&&(n.length>0&&n[1]===t)}function tc(e,t){const n=e.tags.find((e=>"method"===e[0]));return!!n&&(n.length>0&&n[1].toLowerCase()===t.toLowerCase())}function nc(e){return ve(go($i.encode(JSON.stringify(e))))}function rc(e,t){const n=e.tags.find((e=>"payload"===e[0]));if(!n)return!1;const r=nc(t);return n.length>0&&n[1]===r}async function oc(e,t,n,r){if(!Vi(e))throw new Error("Invalid nostr event, signature invalid");if(!Xl(e))throw new Error("Invalid nostr event, kind invalid");if(!Ql(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!ec(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!tc(e,n))throw new Error("Invalid nostr event, method tag invalid");if(Boolean(r)&&"object"==typeof r&&Object.keys(r).length>0&&!rc(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const ic=(e,t,n)=>({pk:e,signEvent:async e=>n?{sig:qi(e,n).sig}:(await t()).signEvent(e),nip04:{decrypt:async(e,r)=>{if(n)throw new Error("Not supported");return(await t()).nip04.decrypt(e,r)},encrypt:async(e,r)=>{if(n)throw new Error("Not supported");return(await t()).nip04.encrypt(e,r)}},nip44:{decrypt:async(e,r)=>{if(n)throw new Error("Not supported");return(await t()).nip44.decrypt(e,r)},encrypt:async(e,r)=>{if(n)throw new Error("Not supported");return(await t()).nip44.encrypt(e,r)}}});var sc=J("<div class=ztr-reply-form>"),ac=J('<input placeholder="Reply something...">'),lc=J("<textarea>"),cc=J("<div class=ztr-reply-controls><button class=ztr-reply-login-button>"),uc=J("<div class=ztr-comment-info-picture><img>"),dc=J("<div class=ztr-reply-controls>"),hc=J("<span>Publishing is disabled"),fc=J("<span class=ztr-reply-error>Error: "),pc=J('<svg class=ztr-spinner viewBox="0 0 50 50"><circle class=path cx=25 cy=25 r=20 fill=none stroke-width=5>'),gc=J("<button class=ztr-reply-button>"),yc=J('<button class="ztr-reply-button ztr-reply-button--cancel">Cancel'),mc=J("<button class=ztr-reply-login-button>Log in"),wc=J("<div class=ztr-comment-new><div class=ztr-comment-body>"),bc=J("<li class=ztr-comment-action-like><span> likes"),vc=J("<li class=ztr-comment-action-zap><span> sats"),Ec=J("<ul class=ztr-comment-actions>");const xc=e=>{const t=e.pool,n=e.store,[r,o]=w(""),[i,s]=w(!1),[a,l]=w(!1),[c,u]=w(),[d,h]=w(""),f=()=>n.anchor,p=n.profiles,g=()=>n.relays,y="true"===n.npubPro,m="dm"===n.mode,b=async()=>{if(y&&l(!0),!window.nostr)return void A("Error: No NIP-07 extension!");const e=await window.nostr.getPublicKey();fn.internal=ic(e,(()=>Promise.resolve(window.nostr))),h(""),fn.active=fn.internal};E((async()=>{if(fn.active){const e=fn.active.pk;let n=p().find((t=>t.pk===e));n||(n={pk:e,l:0,ts:0},await Kt("profiles",n)),u(n),Jt(t,[e],g(),p())}else u()})),E((async()=>{y&&c()&&a()&&(l(!1),r().length&&await S(c()))}));const k=async(t,n,r)=>{var i;s(!1),o(""),h(r??"");const a=Pt(t);m&&await Lt(a,n),await Kt("events",a,{immediate:!0}),null==(i=e.onDone)||i.call(void 0)},A=e=>{s(!1),h(`Error: ${e}`)},S=async o=>{let i;if(o)i=fn.active;else{if(!fn.anonymous){const e=xo();fn.anonymous={pk:ko(e),signEvent:async t=>({sig:Ao(t,e).sig}),nip04:{encrypt:(t,n)=>Fa.encrypt(e,t,n),decrypt:(t,n)=>Fa.decrypt(e,t,n)},nip44:{encrypt:(t,n)=>Promise.resolve(_l.encrypt(n,_l.getConversationKey(e,t))),decrypt:(t,n)=>Promise.resolve(_l.decrypt(n,_l.getConversationKey(e,t)))}}}i=fn.anonymous}if(!(null==i?void 0:i.signEvent))return void A("Error: User has no signer!");const a=r().trim();if(!a)return;let l;if(m){let e="";i.nip04.encrypt&&(e=await i.nip04.encrypt(f().value,a)),l={kind:4,created_at:Math.round(Date.now()/1e3),content:e,pubkey:i.pk,tags:[]}}else l={kind:1,created_at:Math.round(Date.now()/1e3),content:a,pubkey:i.pk,tags:nn(a)};if(n.anchorAuthor!==l.pubkey&&l.tags.push(["p",n.anchorAuthor]),n.externalAuthor)try{const e=Oe(n.externalAuthor).data;l.tags.push(["p",e])}catch(h){}if(n.client&&!m&&l.tags.push(["client",n.client]),!m)if(e.replyTo){const t=await qt("events",IDBKeyRange.only(e.replyTo));t&&(l.tags.push(["e",t.ro,"","root"]),t.pk!==l.pubkey&&l.tags.push(["p",t.pk])),l.tags.push(["e",e.replyTo,"","reply"])}else{const e=n.version||n.rootEventIds[0];if(e)l.tags.push(["e",e,"","root"]);else if("http"===f().type){const e=function(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}(f().value),r={pubkey:i.pk,created_at:Math.round(Date.now()/1e3),kind:8812,tags:[["r",e]],content:`Comments on ${e} ↴`},o={id:vo(r),...r,...await i.signEvent(r)};Kt("events",Pt(o)),n.disableFeatures.includes("publish")?console.log("Publishing root event disabled",o):t.publish(g(),o),n.filter={"#e":[o.id]},l.tags.push(["e",o.id,"","root"])}}"naddr"===f().type&&l.tags.push(["a",f().value,"","root"]);const c=vo(l);s(!0);const u=await i.signEvent(l),d={id:c,...l,...u};if(console.log(JSON.stringify(d,null,2)),n.disableFeatures.includes("publish"))setTimeout((()=>k(d,i)),1e3);else{const e=[],t=[];for(const n of g())t.push(new Promise((async t=>{try{const t=await jo.connect(n);await t.publish(d),e.push(n)}catch(r){console.warn(r)}t()})));if(await Promise.race([Promise.allSettled(t),new Promise((e=>setTimeout((()=>{console.log("send timeout"),e()}),1e4)))]),e.length){const t=`Published to ${e.length}/${g().length} relays (see console for more info)`,n=!y&&e.length<g().length?t:void 0;k(d,i,n)}else A("Error: Your comment was not published to any relay")}},z=void 0!==e.replyTo;let T;return(e=>{E((()=>{const t=e();t&&setTimeout((()=>t.focus()))}))})((()=>!!e.isFocus&&(z&&T))),te(O=sc(),(I=x((()=>!!e.input)),()=>{return I()?((s=ac()).addEventListener("change",(e=>o(e.target.value))),"function"==typeof T?ee(T,s):T=s,v((t=>{var n=i(),r=!!e.isFocus&&z;return n!==t.e&&(s.disabled=t.e=n),r!==t.t&&(s.autofocus=t.t=r),t}),{e:void 0,t:void 0}),v((()=>s.value=r())),s):((t=lc()).addEventListener("change",(e=>o(e.target.value))),"function"==typeof T?ee(T,t):T=t,t.autofocus=z,v((e=>{var r=i(),o=n.replyPlaceholder||(m?"Your message...":"Add your comment...");return r!==e.e&&(t.disabled=e.e=r),o!==e.t&&Y(t,"placeholder",e.t=o),e}),{e:void 0,t:void 0}),v((()=>t.value=r())),t);var t,s}),null),te(O,(_=x((()=>!(!y||c()))),()=>{return _()&&(e=cc(),(t=e.firstChild).$$click=()=>b(),te(t,m?"Send":"Reply"),e);var e,t}),null),te(O,(C=x((()=>!(y&&!c()))),()=>{return C()&&(te(l=dc(),(t=x((()=>!!n.disableFeatures.includes("publish"))),()=>t()&&hc()),null),te(l,(r=x((()=>!!d())),()=>{return r()&&((e=fc()).firstChild,te(e,d,null),e);var e}),null),te(l,F(W,{get when(){return!i()},get fallback(){return pc()},get children(){var e=uc(),t=e.firstChild;return v((()=>{var e;return Y(t,"src",(null==(e=c())?void 0:e.i)||an)})),e}}),null),te(l,(o=x((()=>!!c())),()=>{return o()&&[x((()=>{return x((()=>!!e.onCancel))()&&((t=yc()).$$click=()=>{e.onCancel&&e.onCancel()},v((()=>t.disabled=i())),t);var t})),(t=gc(),t.$$click=()=>S(c()),te(t,y&&(m?"Send":"Reply"),null),te(t,!y&&[m?"Send":"Reply"," as"," ",x((()=>c().n||rn(Be(c().pk))))],null),v((()=>t.disabled=i())),t)];var t}),null),te(l,(s=x((()=>!(c()||n.disableFeatures.includes("replyAnonymously")))),()=>{return s()&&((e=gc()).$$click=()=>S(),te(e,m?"Send anonymously":"Reply"),v((()=>e.disabled=i())),e);var e}),null),te(l,(a=x((()=>!c())),()=>{return a()&&((e=mc()).$$click=()=>b(),e);var e}),null),l);var t,r,o,s,a,l}),null),O;var I,_,C,O},kc=e=>{const t=()=>e.store.anchor,n="dm"===e.store.mode,r=Mt((()=>["aggregates",IDBKeyRange.only([t().value,9735])])),o=Mt((()=>["aggregates",IDBKeyRange.only([t().value,7])])),i=()=>{var e;return(null==(e=o())?void 0:e.ids.length)??0};return a=wc(),te(l=a.firstChild,!n&&(te(s=Ec(),F(W,{get when(){return!e.store.disableFeatures.includes("likes")},get children(){var e=bc(),t=e.firstChild,n=t.firstChild;return te(e,Yc,t),te(t,i,n),e}}),null),te(s,F(W,{get when(){return!e.store.disableFeatures.includes("zaps")},get children(){var e=vc(),t=e.firstChild,n=t.firstChild;return te(e,Gc,t),te(t,(()=>{return(e=(null==(t=r())?void 0:t.sum)??0)<1e4?e.toString():e<1e6?Math.round(e/1e3)+"k":Math.round(e/1e6)+"M";var e,t}),n),e}}),null),s),null),te(l,F(xc,{get store(){return e.store},get pool(){return e.pool},onDone:()=>{e.handleExitThread&&(e.store.activeThreadId=null)}}),null),a;var s,a,l};function Ac(e,...t){return"function"==typeof e?e(...t):e}G(["click"]);var Sc={width:null,height:null};function zc(e){if(!e)return{...Sc};const{width:t,height:n}=e.getBoundingClientRect();return{width:t,height:n}}function Tc(e){const t="function"==typeof e,[n,r]=function(e){const t={...e},n={...e},r={},o=e=>{let n=r[e];if(!n){if(!_())return t[e];r[e]=n=w(t[e],{internal:!0}),delete t[e]}return n[0]()};for(const s in e)Object.defineProperty(n,s,{get:()=>o(s),enumerable:!0});const i=(e,n)=>{const o=r[e];if(o)return o[1](n);e in t&&(t[e]=Ac(n,[t[e]]))};return[n,(e,t)=>{if(null===(r=e)||"object"!=typeof r&&"function"!=typeof r)i(e,t);else{const t=S((()=>Object.entries(Ac(e,n))));A((()=>{for(const[e,n]of t)i(e,(()=>n))}))}var r;return n}]}(t?Sc:zc(e)),o=new ResizeObserver((([e])=>r(zc(e.target))));return I((()=>o.disconnect())),t?E((()=>{const t=e();t&&(r(zc(t)),o.observe(t),I((()=>o.unobserve(t))))})):(o.observe(e),I((()=>o.unobserve(e)))),n}var Ic=J("<div class=ztr-thread>"),_c=J("<li class=ztr-comment-action-reply><span>"),Cc=J("<div class=ztr-comment><div class=ztr-comment-body><div class=ztr-comment-info-wrapper><div class=ztr-comment-info><div class=ztr-comment-info-picture><img></div><ul class=ztr-comment-info-items><li class=ztr-comment-info-author><a target=_blank></a><span style=white-space:nowrap;><strong> <!>ed</strong> </span></li><li><a class=ztr-comment-info-dots></a></li></ul></div><ul class=ztr-comment-info-items></ul></div><div class=ztr-comment-text></div><div class=ztr-comment-text></div><ul class=ztr-comment-actions>"),Oc=J("<li>●"),Lc=J("<li> repl"),Bc=J("<li><span>"),$c=J("<div class=ztr-info-pane><a target=_blank><small>Event data"),Pc=J("<p class=warning><span>This is a <!> that referenced this article in <a>another thread"),Rc=J("<p class=warning><span>Article contents may have changed since this <!> was made"),Uc=J("<p class=warning><span>Article contents changed since this <!> was made"),Nc=J("<div class=ztr-comment-expand><a></a><span>Show full comment"),jc=J("<div class=ztr-comment-replies>"),Hc=J('<svg viewBox="0 -6 60 60"xmlns=http://www.w3.org/2000/svg><path d="M 12.6030 50.4905 C 13.3758 50.4905 13.9307 50.1140 14.8621 49.2421 L 20.6483 43.8720 C 19.5188 42.9803 18.6073 41.5733 18.6073 38.3433 L 18.6073 25.2052 C 18.6073 19.1217 22.3129 15.5152 28.3766 15.5152 L 42.2479 15.5152 L 42.2281 14.7622 C 41.9306 10.6999 39.2557 8.0643 34.7177 8.0643 L 7.5301 8.0643 C 2.9922 8.0643 0 10.7791 0 15.4954 L 0 34.9548 C 0 39.6710 2.9922 42.7028 7.5301 42.7028 L 10.8195 42.7028 L 10.8195 48.4693 C 10.8195 49.6979 11.4735 50.4905 12.6030 50.4905 Z M 44.6058 53.2450 C 45.7353 53.2450 46.3895 52.4325 46.3895 51.2237 L 46.3895 45.4374 L 48.4702 45.4374 C 53.0078 45.4374 56 42.4056 56 37.7092 L 56 25.6610 C 56 20.9250 53.0078 18.2300 48.4702 18.2300 L 28.8522 18.2300 C 24.1161 18.2300 21.3221 20.9250 21.3221 25.6610 L 21.3221 37.7092 C 21.3221 42.4056 24.1161 45.4374 28.8522 45.4374 L 35.1735 45.4374 L 42.3470 51.9767 C 43.2784 52.8487 43.8331 53.2450 44.6058 53.2450 Z">'),Mc=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="-120 -80 528 588"><path d="M349.4 44.6c5.9-13.7 1.5-29.7-10.6-38.5s-28.6-8-39.9 1.8l-256 224c-10 8.8-13.6 22.9-8.9 35.3S50.7 288 64 288H175.5L98.6 467.4c-5.9 13.7-1.5 29.7 10.6 38.5s28.6 8 39.9-1.8l256-224c10-8.8 13.6-22.9 8.9-35.3s-16.6-20.7-30-20.7H272.5L349.4 44.6z">'),Dc=J('<svg viewBox="0 -16 180 180"xmlns=http://www.w3.org/2000/svg><path d="M60.732 29.7C41.107 29.7 22 39.7 22 67.41c0 27.29 45.274 67.29 74 94.89 28.744-27.6 74-67.6 74-94.89 0-27.71-19.092-37.71-38.695-37.71C116 29.7 104.325 41.575 96 54.066 87.638 41.516 76 29.7 60.732 29.7z">'),qc=J('<svg viewBox="0 0 576 512"><path d="M168 80c-13.3 0-24 10.7-24 24V408c0 8.4-1.4 16.5-4.1 24H440c13.3 0 24-10.7 24-24V104c0-13.3-10.7-24-24-24H168zM72 480c-39.8 0-72-32.2-72-72V112C0 98.7 10.7 88 24 88s24 10.7 24 24V408c0 13.3 10.7 24 24 24s24-10.7 24-24V104c0-39.8 32.2-72 72-72H440c39.8 0 72 32.2 72 72V408c0 39.8-32.2 72-72 72H72zM176 136c0-13.3 10.7-24 24-24h96c13.3 0 24 10.7 24 24v80c0 13.3-10.7 24-24 24H200c-13.3 0-24-10.7-24-24V136zm200-24h32c13.3 0 24 10.7 24 24s-10.7 24-24 24H376c-13.3 0-24-10.7-24-24s10.7-24 24-24zm0 80h32c13.3 0 24 10.7 24 24s-10.7 24-24 24H376c-13.3 0-24-10.7-24-24s10.7-24 24-24zM200 272H408c13.3 0 24 10.7 24 24s-10.7 24-24 24H200c-13.3 0-24-10.7-24-24s10.7-24 24-24zm0 80H408c13.3 0 24 10.7 24 24s-10.7 24-24 24H200c-13.3 0-24-10.7-24-24s10.7-24 24-24z">'),Vc=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 -200 560 640"><path d="M8 256a56 56 0 1 1 112 0A56 56 0 1 1 8 256zm160 0a56 56 0 1 1 112 0 56 56 0 1 1 -112 0zm216-56a56 56 0 1 1 0 112 56 56 0 1 1 0-112z">'),Fc=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 -50 256 512"><path d="M246.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 256c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l128-128z">'),Kc=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 -50 320 512"><path d="M137.4 374.6c12.5 12.5 32.8 12.5 45.3 0l128-128c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8L32 192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l128 128z">'),Wc=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 512 512"><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z">');const Zc=e=>{const t=e.store,n=e.pool,r=t.profiles;return te(o=Ic(),F(K,{get each(){return on(e.nestedEvents())},children:o=>{const[i,s]=w(!1),[a,l]=w(!1),[c,u]=w(!1),[d,h]=w(!1),[f,p]=w(),g=Tc(f),[y,m]=w(an),b=()=>o().pk,k=()=>Be(b()),A=()=>r().find((e=>e.pk===b()));let S;E((async()=>{var e;m((null==(e=A())?void 0:e.i)||an)}));const z=()=>ln(1e3*o().ts),[T,_]=w();E((()=>{_(z()),S=setInterval((()=>{_(z())}),6e4)}));const C=()=>o().a===t.anchor.value&&o().am,O=()=>9802===o().k?"highlight":C()?"mention":"comment",L=x((()=>cn(o())));return I((()=>clearInterval(S))),(()=>{var r=Cc(),f=r.firstChild,w=f.firstChild,b=w.firstChild,E=b.firstChild,S=E.firstChild,z=E.nextSibling,I=z.firstChild,_=I.firstChild,C=_.nextSibling,B=C.firstChild,$=B.firstChild.nextSibling;$.nextSibling,B.nextSibling;var P,R,U,N,j,H,M,D,q,V=I.nextSibling,K=V.firstChild,Z=b.nextSibling,J=w.nextSibling,G=J.nextSibling,Q=G.nextSibling;return S.addEventListener("error",(()=>m(an))),te(_,(()=>{var e;return(null==(e=A())?void 0:e.n)||rn(k())})),te(B,O,$),te(C,T,null),te(z,(P=x((()=>!!(L()>0&&g.width>600))),()=>{return P()&&[Oc(),(e=Lc(),t=e.firstChild,te(e,L,t),te(e,(()=>L()>1?"ies":"y"),null),te(e,(()=>c()?" (hidden)":""),null),e)];var e,t}),V),K.$$click=()=>h(!d()),te(K,Xc),te(Z,(R=x((()=>L()>0)),()=>{return R()&&(t=Bc(),(n=t.firstChild).$$click=()=>u(!c()),te(n,(e=x((()=>!!c())),()=>e()?eu():tu())),t);var e,t,n})),te(f,(U=x((()=>!!d())),()=>{return U()&&(e=$c(),n=e.firstChild,v((()=>Y(n,"href",t.urlPrefixes.note+$e(o().id)))),e);var e,n}),J),te(J,(N=x((()=>!(o().parent||!o().ro||t.rootEventIds.includes(o().ro)))),()=>{return N()&&(e=Pc(),n=e.firstChild,r=n.firstChild.nextSibling,i=r.nextSibling.nextSibling,te(e,nu,n),te(n,O,r),v((()=>Y(i,"href",t.urlPrefixes.note+$e(o().ro)))),e);var e,n,r,i}),null),te(J,(j=x((()=>!(o().parent||o().ro))),()=>{return j()&&(e=Rc(),t=e.firstChild,(n=t.firstChild.nextSibling).nextSibling,te(e,nu,t),te(t,O,n),e);var e,t,n}),null),te(J,(H=x((()=>!(o().parent||!o().ro||!t.rootEventIds.includes(o().ro)||!t.version||t.version===o().ro))),()=>{return H()&&(e=Uc(),t=e.firstChild,(n=t.firstChild.nextSibling).nextSibling,te(e,nu,t),te(t,O,n),e);var e,t,n}),null),ee(p,G),te(f,(M=x((()=>!(!(g.height&&g.height>=500)||a()))),()=>{return M()&&(e=Nc(),t=e.firstChild,n=t.nextSibling,t.style.setProperty("height","20px"),te(t,Qc),n.$$click=()=>l(!0),e);var e,t,n}),Q),te(Q,F(W,{get when(){return!t.disableFeatures.includes("reply")},get children(){var e=_c(),t=e.firstChild;return e.$$click=()=>s(!i())&&h(!1),te(e,Jc,t),te(t,(()=>i()?"Cancel":"Reply")),e}})),te(f,(D=x((()=>!!i())),()=>D()&&F(xc,{store:t,pool:n,get replyTo(){return o().id},onDone:()=>s(!1)})),null),te(r,(q=x((()=>!c())),()=>{return q()&&(te(r=jc(),F(Zc,{store:t,pool:n,nestedEvents:()=>o().children,get articles(){return e.articles}})),r);var r}),null),v((n=>{var r=y(),i=t.urlPrefixes.npub+k(),s=!(9802!=o().k),l=a()?{}:{"max-height":"500px"},c=tn(o(),t,e.articles());return r!==n.e&&Y(S,"src",n.e=r),i!==n.t&&Y(_,"href",n.t=i),s!==n.a&&G.classList.toggle("highlight",n.a=s),n.o=X(G,l,n.o),c!==n.i&&(G.innerHTML=n.i=c),n}),{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),r})()}})),o;var o},Jc=()=>{return Y(e=Hc(),"width",sn),Y(e,"height",sn),e;var e},Gc=()=>{return Y(e=Mc(),"width",sn),Y(e,"height",sn),e;var e},Yc=()=>{return Y(e=Dc(),"width",sn),Y(e,"height",sn),e;var e},Qc=()=>{return Y(e=qc(),"width",sn),Y(e,"height",sn),e;var e},Xc=()=>Vc(),eu=()=>Fc(),tu=()=>Kc(),nu=()=>{return Y(e=Wc(),"height",sn),e;var e};G(["click"]);const{bech32:ru,hex:ou,utf8:iu}=Ie,su={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},au={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},lu={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},cu={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},uu={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},du=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],hu={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},fu=BigInt("2100000000000000000"),pu=BigInt(1e11),gu={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},yu={};for(let ud=0,dd=Object.keys(gu);ud<dd.length;ud++){const e=dd[ud],t=gu[dd[ud]].toString();yu[t]=e}const mu={1:e=>ou.encode(ru.fromWordsUnsafe(e)),16:e=>ou.encode(ru.fromWordsUnsafe(e)),13:e=>iu.encode(ru.fromWordsUnsafe(e)),19:e=>ou.encode(ru.fromWordsUnsafe(e)),23:e=>ou.encode(ru.fromWordsUnsafe(e)),27:e=>ou.encode(ru.fromWordsUnsafe(e)),6:bu,24:bu,3:function(e){const t=[];let n,r,o,i,s,a=ru.fromWordsUnsafe(e);for(;a.length>0;)n=ou.encode(a.slice(0,33)),r=ou.encode(a.slice(33,41)),o=parseInt(ou.encode(a.slice(41,45)),16),i=parseInt(ou.encode(a.slice(45,49)),16),s=parseInt(ou.encode(a.slice(49,51)),16),a=a.slice(51),t.push({pubkey:n,short_channel_id:r,fee_base_msat:o,fee_proportional_millionths:i,cltv_expiry_delta:s});return t},5:function(e){const t=e.slice().reverse().map((e=>[!!(1&e),!!(2&e),!!(4&e),!!(8&e),!!(16&e)])).reduce(((e,t)=>e.concat(t)),[]);for(;t.length<2*du.length;)t.push(!1);const n={};du.forEach(((e,r)=>{let o;o=t[2*r]?"required":t[2*r+1]?"supported":"unsupported",n[e]=o}));const r=t.slice(2*du.length);return n.extra_bits={start_bit:2*du.length,bits:r,has_required:r.reduce(((e,t,n)=>n%2!=0?e||!1:e||t),!1)},n}};function wu(e){return t=>({tagCode:parseInt(e),words:ru.encode("unknown",t,Number.MAX_SAFE_INTEGER)})}function bu(e){return e.reverse().reduce(((e,t,n)=>e+t*Math.pow(32,n)),0)}function vu(e,t){let n,r;if(e.slice(-1).match(/^[munp]$/))n=e.slice(-1),r=e.slice(0,-1);else{if(e.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");r=e}if(!r.match(/^\d+$/))throw new Error("Not a valid human readable amount");const o=BigInt(r),i=n?o*pu/hu[n]:o*pu;if("p"===n&&o%BigInt(10)!==BigInt(0)||i>fu)throw new Error("Amount is outside of valid range");return t?i.toString():i}var Eu={decode:function(e,t){if("string"!=typeof e)throw new Error("Lightning Payment Request must be string");if("ln"!==e.slice(0,2).toLowerCase())throw new Error("Not a proper lightning payment request");const n=[],r=ru.decode(e,Number.MAX_SAFE_INTEGER);e=e.toLowerCase();const o=r.prefix;let i=r.words,s=e.slice(o.length+1),a=i.slice(-104);i=i.slice(0,-104);let l=o.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(l&&!l[2]&&(l=o.match(/^ln(\S+)$/)),!l)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});const c=l[1];let u;if(t){if(void 0===t.bech32||void 0===t.pubKeyHash||void 0===t.scriptHash||!Array.isArray(t.validWitnessVersions))throw new Error("Invalid network");u=t}else switch(c){case su.bech32:u=su;break;case au.bech32:u=au;break;case lu.bech32:u=lu;break;case cu.bech32:u=cu;break;case uu.bech32:u=uu}if(!u||u.bech32!==c)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:c,value:u});const d=l[2];let h;if(d){h=vu(d+l[3],!0),n.push({name:"amount",letters:l[2]+l[3],value:h})}else h=null;n.push({name:"separator",letters:"1"});const f=bu(i.slice(0,7));let p,g,y,m;for(i=i.slice(7),n.push({name:"timestamp",letters:s.slice(0,7),value:f}),s=s.slice(7);i.length>0;){const e=i[0].toString();p=yu[e]||"unknown_tag",g=mu[e]||wu(e),i=i.slice(1),y=bu(i.slice(0,2)),i=i.slice(2),m=i.slice(0,y),i=i.slice(y),n.push({name:p,tag:s[0],letters:s.slice(0,3+y),value:g(m)}),s=s.slice(3+y)}n.push({name:"signature",letters:s.slice(0,104),value:ou.encode(ru.fromWordsUnsafe(a))}),s=s.slice(104),n.push({name:"checksum",letters:s});let w={paymentRequest:e,sections:n,get expiry(){let e=n.find((e=>"expiry"===e.name));if(e)return b("timestamp")+e.value},get route_hints(){return n.filter((e=>"route_hint"===e.name)).map((e=>e.value))}};for(let v in gu)"route_hint"!==v&&Object.defineProperty(w,v,{get:()=>b(v)});return w;function b(e){let t=n.find((t=>t.name===e));return t?t.value:void 0}},hrpToMillisat:vu},xu=J('<div class="ztr-thread chat-mode">'),ku=J("<div><div><div class=ztr-comment-info-wrapper><div class=ztr-comment-info><div class=ztr-comment-info-picture><div class=ztr-comment-picture-wrap><img></div></div><ul class=ztr-comment-info-items><li class=ztr-comment-info-author><a target=_blank></a><span style=white-space:nowrap;> </span></li><li><a class=ztr-comment-info-dots></a></li></ul></div><ul class=ztr-comment-info-items></ul></div><div class=ztr-comment-text>"),Au=J('<ul class="ztr-comment-actions p-0 mb-1"><li class=ztr-comment-action-reply><span class=p-0>Back'),Su=J("<strong class=ztr-action-commented> <!>ed"),zu=J("<li>●"),Tu=J("<li> repl"),Iu=J("<li>"),_u=J("<span>"),Cu=J("<div class=ztr-info-pane><a target=_blank><small>Event data"),Ou=J("<div class=ztr-reply-message><span>"),Lu=J("<div><div class=replied-budge>Reply: <span>"),Bu=J("<div>"),$u=J("<p class=warning><span>This is a <!> that referenced this article in <a>another thread"),Pu=J("<p class=warning><span>Article contents may have changed since this <!> was made"),Ru=J("<p class=warning><span>Article contents changed since this <!> was made"),Uu=J("<div class=ztr-comment-expand><a></a><span>Show full "),Nu=J("<li class=ztr-comment-action-reply><span>"),ju=J("<ul class=ztr-comment-actions>"),Hu=J("<li class=ztr-comment-action-reply>"),Mu=J("<span> repl"),Du=J("<div class=ztr-comment-replies>"),qu=J("<div class=footer-editor>"),Vu=J('<svg viewBox="0 -6 60 60"xmlns=http://www.w3.org/2000/svg><path d="M 12.6030 50.4905 C 13.3758 50.4905 13.9307 50.1140 14.8621 49.2421 L 20.6483 43.8720 C 19.5188 42.9803 18.6073 41.5733 18.6073 38.3433 L 18.6073 25.2052 C 18.6073 19.1217 22.3129 15.5152 28.3766 15.5152 L 42.2479 15.5152 L 42.2281 14.7622 C 41.9306 10.6999 39.2557 8.0643 34.7177 8.0643 L 7.5301 8.0643 C 2.9922 8.0643 0 10.7791 0 15.4954 L 0 34.9548 C 0 39.6710 2.9922 42.7028 7.5301 42.7028 L 10.8195 42.7028 L 10.8195 48.4693 C 10.8195 49.6979 11.4735 50.4905 12.6030 50.4905 Z M 44.6058 53.2450 C 45.7353 53.2450 46.3895 52.4325 46.3895 51.2237 L 46.3895 45.4374 L 48.4702 45.4374 C 53.0078 45.4374 56 42.4056 56 37.7092 L 56 25.6610 C 56 20.9250 53.0078 18.2300 48.4702 18.2300 L 28.8522 18.2300 C 24.1161 18.2300 21.3221 20.9250 21.3221 25.6610 L 21.3221 37.7092 C 21.3221 42.4056 24.1161 45.4374 28.8522 45.4374 L 35.1735 45.4374 L 42.3470 51.9767 C 43.2784 52.8487 43.8331 53.2450 44.6058 53.2450 Z">'),Fu=J('<svg viewBox="0 0 576 512"><path d="M168 80c-13.3 0-24 10.7-24 24V408c0 8.4-1.4 16.5-4.1 24H440c13.3 0 24-10.7 24-24V104c0-13.3-10.7-24-24-24H168zM72 480c-39.8 0-72-32.2-72-72V112C0 98.7 10.7 88 24 88s24 10.7 24 24V408c0 13.3 10.7 24 24 24s24-10.7 24-24V104c0-39.8 32.2-72 72-72H440c39.8 0 72 32.2 72 72V408c0 39.8-32.2 72-72 72H72zM176 136c0-13.3 10.7-24 24-24h96c13.3 0 24 10.7 24 24v80c0 13.3-10.7 24-24 24H200c-13.3 0-24-10.7-24-24V136zm200-24h32c13.3 0 24 10.7 24 24s-10.7 24-24 24H376c-13.3 0-24-10.7-24-24s10.7-24 24-24zm0 80h32c13.3 0 24 10.7 24 24s-10.7 24-24 24H376c-13.3 0-24-10.7-24-24s10.7-24 24-24zM200 272H408c13.3 0 24 10.7 24 24s-10.7 24-24 24H200c-13.3 0-24-10.7-24-24s10.7-24 24-24zm0 80H408c13.3 0 24 10.7 24 24s-10.7 24-24 24H200c-13.3 0-24-10.7-24-24s10.7-24 24-24z">'),Ku=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 -200 560 640"><path d="M8 256a56 56 0 1 1 112 0A56 56 0 1 1 8 256zm160 0a56 56 0 1 1 112 0 56 56 0 1 1 -112 0zm216-56a56 56 0 1 1 0 112 56 56 0 1 1 0-112z">'),Wu=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 -50 256 512"><path d="M246.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 256c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l128-128z">'),Zu=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 512 512"><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z">'),Ju=J('<svg height=512px id=Layer_1 style="enable-background:new 0 0 512 512;"version=1.1 viewBox="0 0 512 512"width=512px><polygon points="352,128.4 319.7,96 160,256 160,256 160,256 319.7,416 352,383.6 224.7,256 ">');const Gu=e=>{const t=e.store,n=e.pool,r=()=>t.anchor,o=t.profiles,i="dm"===t.mode,s={};let a;i&&(s["max-height"]=Math.floor(window.innerHeight/2.2)+"px");const l=()=>{i&&a&&(a.scrollTop=a.scrollHeight)};return T(l),E(z([e.nestedEvents],(()=>{l()}))),c=xu(),"function"==typeof a?ee(a,c):a=c,X(c,s),te(c,F(K,{get each(){return x((()=>!!e.child))()?e.nestedEvents():on(e.nestedEvents()).reverse()},children:s=>{const[a,l]=w(!1),[c,u]=w(!1),[d,h]=w(!0),[f,p]=w(!1),[g,y]=w(),m=Tc(g),[k,A]=w(an),S=()=>s().pk,_=()=>Be(S()),C=()=>o().find((e=>e.pk===S())),O=S()!==r().value;let L;E((async()=>{var e;A((null==(e=C())?void 0:e.i)||an)}));const B=()=>ln(1e3*s().ts),[$,P]=w();E((()=>{P(B()),L=setInterval((()=>{P(B())}),6e4)}));const R=()=>9802===s().k?"highlight":s().a===r().value&&s().am?"mention":"comment",U=x((()=>cn(s())));I((()=>clearInterval(L)));const N=()=>{t.activeThreadId=s().id,t.initialThreadId=s().id,h(!1)},j=()=>{null===t.activeThreadId&&null===t.initialThreadId&&(t.activeThreadId=s().id,h(!1))};let H,M;E((()=>{s().parent&&h(!1),t.activeThreadId||h(!0),t.initialThreadId===s().id&&H&&null===t.activeThreadId&&H.scrollIntoView({behavior:"auto",block:"start"}),t.initialThreadId===s().id&&H&&M&&null!==t.activeThreadId&&(H.scrollIntoView({behavior:"smooth",block:"start"}),M.classList.contains("highlightable")?(M.classList.remove("highlightable"),setTimeout((()=>{M.classList.add("highlightable")}),100)):M.classList.add("highlightable"),setTimeout((()=>{t.initialThreadId=null,M.classList.remove("highlightable")}),1e3))}));const D=s().parent?(e=>{const t=[...e.matchAll(/<p>([^<]*)</g)];console.log("extractFirstParagraph",e,t);for(const n of t)if(n[1])return n[1];return null})(tn(s().parent,t,e.articles())):"";T((()=>{const e=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&null===t.activeThreadId&&(t.initialThreadId=null),e.isIntersecting&&t.initialThreadId===s().id?M.classList.contains("highlightable")?(M.classList.remove("highlightable"),setTimeout((()=>{M.classList.add("highlightable")}),100)):M.classList.add("highlightable"):M.classList.remove("highlightable")}))}));M&&e.observe(M),I((()=>{M&&e.unobserve(M),e.disconnect()}))})),b(z([s],(()=>{var e,n;if(t.activeThreadId===s().id&&null===t.initialThreadId&&(t.initialThreadId=null==(e=s().children.sort(((e,t)=>t.ts-e.ts))[0])?void 0:e.id),t.activeThreadId===s().id){const e=e=>{const t=e=>{let n=[];if(n.push({...e,children:[]}),e.children&&e.children.length>0)for(let r of e.children)n=n.concat(t(r));return n};let n=t(e);return n.sort(((e,t)=>t.ts-e.ts)),n};t.initialThreadId=null==(n=e(s())[0])?void 0:n.id}}),{defer:!0}));const q=i?O?"ztr-comment ztr-comment--message ztr-comment--author":"ztr-comment ztr-comment--message":"ztr-comment",V=i?O?"ztr-comment-body ztr-comment-body--message ztr-comment-body--author":"ztr-comment-body ztr-comment-body--message":"ztr-comment-body",K=i?"ztr-comment-text ztr-comment-text--message":"ztr-comment-text";return ge=ku(),ye=ge.firstChild,me=ye.firstChild,we=me.firstChild,be=we.firstChild,ve=be.firstChild.firstChild,Ee=be.nextSibling,xe=Ee.firstChild,ke=xe.firstChild,Ae=ke.nextSibling,Se=Ae.firstChild,ze=xe.nextSibling,Te=ze.firstChild,Ie=we.nextSibling,_e=me.nextSibling,ee((e=>H=e),ge),Q(ge,q),ge.style.setProperty("--highlightable-background","#cccccc"),ee((e=>M=e),ye),Q(ye,V),te(ye,(Z=x((()=>t.activeThreadId===s().id)),()=>{return Z()&&(e=Au(),n=e.firstChild,r=n.firstChild,n.$$click=()=>{s().parent?(t.activeThreadId=s().parent.id,t.initialThreadId=s().id):(t.activeThreadId=null,t.initialThreadId=s().id)},te(n,nd,r),e);var e,n,r}),me),ve.addEventListener("error",(()=>A(an))),te(ke,(()=>{var e;return(null==(e=C())?void 0:e.n)||rn(_())})),te(Ae,!i&&(J=Su(),(G=J.firstChild.nextSibling).nextSibling,te(J,R,G),J),Se),te(Ae,$,null),te(Ee,(ne=x((()=>!!(U()>0&&m.width>600&&t.activeThreadId===s().id))),()=>{return ne()&&[zu(),(e=Tu(),t=e.firstChild,te(e,U,t),te(e,(()=>U()>1?"ies":"y"),null),e)];var e,t}),ze),Te.$$click=()=>p(!f()),te(Te,Xu),te(Ie,(re=x((()=>U()>0)),()=>{return re()&&(te(n=Iu(),(e=x((()=>null===t.activeThreadId)),()=>{return e()&&((t=_u()).$$click=()=>N(),te(t,ed),t);var t})),n);var e,n})),te(ye,(oe=x((()=>!!f())),()=>{return oe()&&(r=Cu(),o=r.firstChild,te(r,i&&(e=Ou(),n=e.firstChild,e.$$click=()=>l(!a())&&p(!1),te(e,Yu,n),te(n,(()=>a()?"Cancel":"Reply")),e),null),v((()=>Y(o,"href",t.urlPrefixes.note+$e(s().id)))),r);var e,n,r,o}),_e),te(ye,(ie=x((()=>!(!s().parent||t.activeThreadId===s().parent.id))),()=>{return ie()&&(e=Lu(),n=e.firstChild,r=n.firstChild.nextSibling,Q(e,K),n.$$click=()=>{t.initialThreadId=s().parent.id},te(r,D),e);var e,n,r}),_e),te(ye,!i&&(Q(ce=Bu(),K),te(ce,(se=x((()=>!(s().parent||!s().ro||t.rootEventIds.includes(s().ro)))),()=>{return se()&&(e=$u(),n=e.firstChild,r=n.firstChild.nextSibling,o=r.nextSibling.nextSibling,te(e,td,n),te(n,R,r),v((()=>Y(o,"href",t.urlPrefixes.note+$e(s().ro)))),e);var e,n,r,o}),null),te(ce,(ae=x((()=>!(s().parent||s().ro))),()=>{return ae()&&(e=Pu(),t=e.firstChild,(n=t.firstChild.nextSibling).nextSibling,te(e,td,t),te(t,R,n),e);var e,t,n}),null),te(ce,(le=x((()=>!(s().parent||!s().ro||!t.rootEventIds.includes(s().ro)||!t.version||t.version===s().ro))),()=>{return le()&&(e=Ru(),t=e.firstChild,(n=t.firstChild.nextSibling).nextSibling,te(e,td,t),te(t,R,n),e);var e,t,n}),null),ce),_e),ee(y,_e),_e.classList.toggle("ztr-comment-text--message",!!i),te(ye,(ue=x((()=>!(!(m.height&&m.height>=500)||c()))),()=>{return ue()&&(e=Uu(),t=e.firstChild,(n=t.nextSibling).firstChild,t.style.setProperty("height","20px"),te(t,Qu),n.$$click=()=>u(!0),te(n,i?"message":"comment",null),e);var e,t,n}),null),te(ye,!i&&(te(de=ju(),F(W,{get when(){return!t.disableFeatures.includes("reply")},get children(){return[(e=Nu(),n=e.firstChild,e.$$click=()=>l(!a())&&p(!1),te(e,Yu,n),te(n,(()=>a()?"Cancel":"Reply")),e),x((()=>{return x((()=>!!Boolean(U())))()&&((n=Hu()).$$click=()=>N(),te(n,(e=x((()=>null===t.activeThreadId)),()=>{return e()&&(t=Mu(),n=t.firstChild,te(t,U,n),te(t,(()=>U()>1?"ies":"y"),null),t);var t,n})),n);var e,n}))];var e,n}})),de),null),te(ye,(he=x((()=>!!a())),()=>he()&&F(xc,{input:!0,isFocus:!0,onCancel:()=>{l(!1)},get replyTo(){return s().id},onDone:()=>{l(!1),j()},pool:n,store:t})),null),te(ge,(fe=x((()=>!d())),()=>{return fe()&&(te(r=Du(),F(Gu,{child:!0,nestedEvents:()=>(e=>{let t=[];const n=e=>{t.push({...e,children:[]}),e.children&&e.children.length>0&&e.children.forEach(n)};return e.forEach(n),t})(s().children).sort(((e,t)=>e.ts-t.ts)),get articles(){return e.articles},pool:n,store:t})),v((e=>null!=(e=t.activeThreadId===s().id?"1em":"0")?r.style.setProperty("padding",e):r.style.removeProperty("padding"))),r);var r}),null),te(ge,(pe=x((()=>t.activeThreadId===s().id)),()=>{return pe()&&(te(e=qu(),F(xc,{input:!0,get replyTo(){return s().id},onDone:()=>{l(!1),j()},pool:n,store:t})),e);var e}),null),v((n=>{var r=t.activeThreadId===s().id||null===t.activeThreadId||s().parent?"block":"none",o=k(),i=t.urlPrefixes.npub+_(),a=!(9802!=s().k),l=c()?{}:{"max-height":"500px"},u=tn(s(),t,e.articles());return r!==n.e&&(null!=(n.e=r)?ge.style.setProperty("display",r):ge.style.removeProperty("display")),o!==n.t&&Y(ve,"src",n.t=o),i!==n.a&&Y(ke,"href",n.a=i),a!==n.o&&_e.classList.toggle("highlight",n.o=a),n.i=X(_e,l,n.i),u!==n.n&&(_e.innerHTML=n.n=u),n}),{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),ge;var Z,J,G,ne,re,oe,ie,se,ae,le,ce,ue,de,he,fe,pe,ge,ye,me,we,be,ve,Ee,xe,ke,Ae,Se,ze,Te,Ie,_e}})),c;var c},Yu=()=>{return Y(e=Vu(),"width",sn),Y(e,"height",sn),e;var e},Qu=()=>{return Y(e=Fu(),"width",sn),Y(e,"height",sn),e;var e},Xu=()=>Ku(),ed=()=>Wu(),td=()=>{return Y(e=Zu(),"height",sn),e;var e},nd=()=>Ju();G(["click"]);var rd=J("<div id=ztr-root><style>"),od=J("<div id=ztr-content>"),id=J("<h1>Error!"),sd=J("<div class=ztr-comment-text><pre></pre><p>Only properly formed NIP-19 naddr, note and nevent encoded entities and URLs are supported."),ad=J("<h2 id=ztr-title>"),ld=J("<div>");const cd=e=>{const[t]=w(new Ca),[n]=w(ct({rootEventIds:[],filter:{},profiles:()=>[],activeThreadId:null,initialThreadId:null})),r=t(),o=n();b((()=>{o.mode=e.mode?e.mode:"",o.npubPro=e.npubPro?e.npubPro:"",o.anchor=(()=>{const t=e.anchor.trim();try{if(t.startsWith("http")){const n=!e.legacyUrl;return{type:"http",value:dn(t,n)}}const n=Oe(t);switch(n.type){case"nevent":return{type:"note",value:n.data.id};case"note":return{type:"note",value:n.data};case"naddr":const e=n.data;return{type:"naddr",value:`${e.kind}:${e.pubkey}:${e.identifier}`};case"npub":return{type:"npub",value:n.data}}}catch(n){return console.error(n),{type:"error",value:`Malformed anchor: ${t}`}}})();o.relays=(e.relays||"wss://relay.damus.io,wss://nos.lol").split(",").map((e=>new URL(e).toString())),(e.author||"").startsWith("npub")&&(o.externalAuthor=e.author),o.disableFeatures=e.disable.split(",").map((e=>e.trim())).filter(gn),o.urlPrefixes=((e="")=>{const t={naddr:"https://njump.me/",npub:"https://njump.me/",nprofile:"https://njump.me/",nevent:"https://njump.me/",note:"https://njump.me/",tag:"https://snort.social/t/"};for(const n of e.split(",")){const[e,r]=n.split(":");r&&(t[e]=`https://${r}`)}return t})(e.urls),o.replyPlaceholder=e.replyPlaceholder,o.client=e.client}));const i=()=>o.anchor,s=()=>o.relays,a=()=>e.version,l="chat"===e.mode||"dm"===e.mode,c="dm"===e.mode;o.profiles=Ht((()=>["profiles"]));const u=()=>o.disableFeatures.includes("watch"),d=()=>e.user,h=()=>fn.active;b(z([i],(()=>{o.version=a()})));const[f,p]=w(!1);b(z([i,h],(async()=>{p(!1);const e=h();if("npub"!==i().type||!c||!e)return;const t=Ot(i().value,e.pk),n=await Dt("events",t,{index:"dm"});for(const r of n)await Lt(r,e);p(!0)}))),b(z([i,s],(async()=>{if("error"===i().type)return;let t,n=[];switch(i().type){case"http":n=await Dt("events",i().value,{index:"r"}),o.rootEventIds=on(n).map((e=>e.id));t={"#r":e.legacyUrl?[i().value]:[i().value,`${i().value}/`],kinds:[1,8812]};break;case"note":const r=await qt("events",IDBKeyRange.only(i().value));if(r)return n=[r],o.rootEventIds=[r.id],void(o.anchorAuthor=r.pk);n=[],t={ids:[i().value]};break;case"naddr":const[s,a,l]=i().value.split(":");n=(await Dt("events",l,{index:"d"})).filter((e=>e.pk===a)),n.length>0&&(o.rootEventIds=on(n).map((e=>e.id)),o.anchorAuthor=n[0].pk),t={authors:[a],kinds:[parseInt(s)],"#d":[l]};break;case"npub":t={authors:[i().value],kinds:[0]};break;default:throw"error"}const a=(await r.querySync(s(),{...t})).map(Pt);for(const e of a)"http"==i().type?(1==e.k&&e.c.includes("↴")||8812==e.k)&&Kt("events",e):Kt("events",e);switch(i().type){case"http":case"naddr":case"npub":const e=[...n,...a],t=on([...e]).map((e=>e.id));(t.length>0&&t[0])!==o.rootEventIds[0]&&(o.rootEventIds=t);break;case"note":o.rootEventIds=a.map((e=>e.id))}a.length>0&&(o.anchorAuthor=a[0].pk)})));const g=()=>o.rootEventIds;b(z([g,a],(()=>{switch(i().type){case"http":case"note":return void((o.filter["#e"]??[]).toString()!==g().toString()&&(o.filter={"#e":g()}));case"naddr":const e=o.filter["#a"]&&o.filter["#a"][0];return i().value!==e&&(o.filter={"#a":[i().value]}),void(o.version=a()||g()[0]);case"npub":const t=fn.active;if(!c||!t)return void(o.filter={});const n=t.pk;return void(o.filter={"#p":[i().value,n],authors:[i().value,n]})}}),{defer:!0}));const y=x((()=>o.filter),{defer:!0});let m=null;E(z([y],(async()=>{const e=y(),t=s(),n=i(),a=T(),l=o.profiles();if(0===Object.entries(e).length)return;null==m||m.close(),m=null,I((()=>{console.log("[zapthreads] unsubscribing and cleaning up",n.value),null==m||m.close(),m=null}));let d=[1,9802,7,9735];c&&(d=[4]),console.log("[zapthreads] subscribing to",n.value);const h=await(async(e,t)=>{const n=(await Dt("relays",e.value,{index:"a"})).filter((e=>t.includes(e.n))).map((e=>e.l));return n.length>0?Math.min(...n)+1:0})(n,t),f=new Set,p={};m=r.subscribeMany(t,[{...e,kinds:d,since:h}],{onevent(e){if(1===e.kind||9802===e.kind)e.content.trim()&&Kt("events",Pt(e));else if(7===e.kind)f.add(e.id);else if(9735===e.kind){const t=e.tags.find((e=>"bolt11"===e[0]));t&&t[1]&&(p[e.id]=t[1])}else if(4===e.kind){const t=Pt(e);Lt(t,fn.active).then((()=>Kt("events",t)))}},oneose(){(async()=>{const e=await qt("aggregates",IDBKeyRange.only([n.value,7]))??{eid:n.value,ids:[],k:7};e.ids=[...new Set([...e.ids,...f])],Kt("aggregates",e);const t=await qt("aggregates",IDBKeyRange.only([n.value,9735]))??{eid:n.value,ids:[],k:9735,sum:0};t.sum=Object.entries(p).reduce(((e,n)=>{if(t.ids.includes(n[0]))return e;const r=Eu.decode(n[1]).sections.find((e=>"amount"===e.name));return e+Number(r.value)/1e3}),t.sum??0),t.ids=[...new Set([...t.ids,...Object.keys(p)])],Kt("aggregates",t)})(),setTimeout((async()=>{await Jt(r,[...a.map((e=>e.pk))],t,l),(async(e,t,n)=>{const r={};for(const i of n){const t=e.seenOn.get(i.id);if(t)for(const e of t)i.ts>(r[e.url]||0)&&(r[e.url]=i.ts)}const o=await Dt("relays",t.value,{index:"a"});for(const i in r){const e=o.find((e=>e.n===i));e?r[i]>e.l&&(e.l=r[i],Kt("relays",e)):Kt("relays",{n:i,a:t.value,l:r[i]})}})(r,n,a),u()&&(null==m||m.close(),r.close(t))}),96)}})}),{defer:!0})),b(z(d,(e=>{if(e){let t,n;e.startsWith("nsec")?(n=Oe(e).data,t=ko(n)):t=e.startsWith("npub")?Oe(e).data:e;const r=async()=>{if(!window.nostr)throw alert("Please log in with a NIP-07 extension such as Alby or nos2x"),fn.active=void 0,"No extension available";const e=await window.nostr.getPublicKey();if(t!==e){const n=`ERROR: Event not signed. Supplied pubkey does not match extension pubkey. ${t} !== ${e}`;throw fn.active=void 0,alert(n),n}return window.nostr};fn.external=ic(t,r,n),fn.active=fn.external}}))),b(z(d,(e=>{e||(fn.active=void 0)}),{defer:!0}));const k=Ht((()=>["events",30023,{index:"k"}])),A=x((()=>{if(o.disableFeatures.includes("hideContent")&&"naddr"===i().type){const[e,t,n]=i().value.split(":"),r=k().find((e=>e.d===n&&e.pk===t));if(r){const e=`# ${r.tl}\n ${r.c}`;return tn({...r,c:e},o,[])}}})),S=x((()=>{var e;const t=null==(e=fn.active)?void 0:e.pk;switch(i().type){case"http":case"note":return Ht((()=>["events",o.rootEventIds,{index:"ro"}]));case"naddr":return Ht((()=>["events",i().value,{index:"a"}]));case"npub":if(c&&t){const e=Ot(i().value,t);return Ht((()=>["events",e,{index:"dm"}]))}}return()=>[]})),T=()=>S()(),_=x((()=>{if(o.rootEventIds&&o.rootEventIds.length){return hn(T()).filter((e=>!(9802===e.k&&0===e.children.length))).map((e=>{var t;return 4===e.k&&f()&&(e.c=(t=e.id,Ct.get(t)||e.c)),e}))}return[]})),C=()=>_().reduce(((e,t)=>e+cn(t)),_().length),O=c?"ztr-root--message":"",L=c?"ztr-root-comment-editor--message":"";return E((()=>{C()})),R=rd(),U=R.firstChild,Q(R,O),te(U,"#ztr-content,\n#ztr-content img {\n  max-width: 100%;\n}\n\n#ztr-root {\n  display: flex;\n  flex-direction: column;\n  font-family: var(--ztr-font);\n  font-size: var(--ztr-font-size);\n  color: var(--ztr-text-color);\n  border: 1px solid transparent;\n  word-wrap: break-word;\n  /* removes margin collapse */\n  margin-top: 4em;\n  line-height: 1.2em;\n  position: relative;\n}\n\n#ztr-subtitle {\n  font-size: 1.2em;\n  color: #666;\n}\n\na {\n  color: var(--ztr-link-color);\n  text-decoration: none;\n}\n\n/* Comment */\n\n.ztr-comment {\n  position: relative;\n  margin: 0;\n  padding: 0;\n}\n\n.ztr-comment,\n.ztr-reply-button {\n  background-color: var(--ztr-background-color, rgba(0, 0, 0, 0.03));\n}\n\n.ztr-comment-body {\n  padding: 1em;\n  transition: 0.3s;\n}\n\n.ztr-comment:first-child {\n  border-top-left-radius: 0.3em;\n  border-top-right-radius: 0.3em;\n}\n\n.ztr-comment:last-child {\n  border-bottom-left-radius: 0.3em;\n  border-bottom-right-radius: 0.3em;\n}\n\n.ztr-comment-info-wrapper {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.ztr-comment-info {\n  display: flex;\n  align-items: center;\n}\n\n.ztr-comment-info-picture {\n  width: 3.5em;\n  /* padding: 0.5em; */\n}\n\nul.ztr-comment-info-items {\n  display: flex;\n  align-items: center;\n  list-style: none;\n  margin: 0;\n  padding: 0;\n  font-size: 0.9em;\n}\n\nul.ztr-comment-info-items li {\n  display: inline-block;\n  cursor: default;\n  padding-right: 0.5em;\n}\n\nul.ztr-comment-info-items li a {\n  font-weight: 600;\n}\n\n.ztr-comment-info-author a {\n  font-size: 1.2em;\n  padding-right: 0.2em;\n}\n\n.ztr-comment-info-dots {\n  cursor: pointer;\n}\n\n.ztr-comment-info-separator {\n  width: 0.5em;\n}\n\n.ztr-comment-info-picture img {\n  width: 2em;\n  height: 2em;\n  border-radius: 50%;\n  position: relative;\n  display: block;\n  object-fit: cover;\n}\n\n.ztr-comment-picture-wrap {\n  padding: 0.5em;\n}\n\n.ztr-comment-text,\n#ztr-content {\n  margin-bottom: 0.75em;\n  padding: 0 0.8em 0 3.5em;\n  line-height: 1.5em;\n  line-break: loose;\n  word-break: break-word;\n  overflow: hidden;\n  max-width: 750px;\n}\n\n.ztr-comment-text p {\n  margin: 0 0 0.5em 0;\n}\n\n.ztr-comment-text code {\n  font-size: 1.1em;\n  margin: 0 0.2em;\n}\n\n.ztr-comment-text pre,\n.ztr-info-pane pre {\n  white-space: pre-wrap;\n  white-space: -moz-pre-wrap;\n  word-wrap: break-word;\n}\n\n.ztr-comment-text a:hover {\n  text-decoration: underline;\n}\n\n.ztr-comment-text img {\n  max-width: 100%;\n}\n\n.ztr-comment-text .warning {\n  margin-top: 0em;\n  font-size: 0.8em;\n  display: flex;\n  align-items: center;\n}\n\n.ztr-comment-text .warning svg {\n  height: 1.2em;\n  fill: #e4984d;\n  padding-right: 0.7em;\n}\n\n.ztr-comment-replies {\n  margin-left: 2em;\n}\n\n.ztr-thread.chat-mode {\n  overflow: auto;\n}\n\n.chat-mode .ztr-comment-replies {\n  margin-left: 0;\n}\n\n.chat-mode .ztr-comment-replies .ztr-comment {\n  background: inherit;\n  padding-top: 1em;\n}\n\n.chat-mode .ztr-comment-replies .ztr-comment-body {\n  border-radius: 1em;\n  /* background: #e9e7e7; */\n\n  background-color: var(--ztr-background-color, rgba(0, 0, 0, 0.03));\n\n  transition: background-color 1s;\n}\n\n.replied-budge {\n  cursor: pointer;\n  max-width: 300px;\n  padding: 0.5em;\n  border-radius: 0.5em;\n  border: 1px solid #a3a3a3;\n  display: flex;\n  text-wrap: nowrap;\n  gap: 10px;\n  background-color: var(--ztr-background-color, rgba(0, 0, 0, 0.03));\n}\n\n.replied-budge span {\n  opacity: 0.7;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.highlightable {\n  animation: highlightable-animation-parent 1s forwards;\n}\n\n.ztr-comment-replies .highlightable {\n  animation: highlightable-animation 1s forwards;\n}\n\n@keyframes highlightable-animation-parent {\n  0% {\n    background-color: var(--highlightable-background);\n  }\n  100% {\n    background-color: initial;\n  }\n}\n\n@keyframes highlightable-animation {\n  0% {\n    background-color: var(--highlightable-background);\n  }\n  100% {\n    background-color: #e9e7e7;\n  }\n}\n\n.highlight p {\n  background: #f6ad55;\n  color: #2b2b2b;\n  display: inline;\n  padding: 0.2em;\n}\n\n/* Styling the reply to comment form */\n\n.ztr-comment-expand {\n  display: flex;\n  justify-content: center;\n}\n\n.ztr-comment-expand span {\n  margin: 1em 0 1em 0.35em;\n  cursor: pointer;\n}\n\nul.ztr-comment-actions,\n.ztr-comment-expand {\n  display: flex;\n  align-items: center;\n  list-style: none;\n  margin: 0;\n  padding: 0 0 0 3.5em;\n  font-weight: 600;\n  user-select: none;\n}\n\nul.ztr-comment-actions li {\n  display: inline-flex;\n  align-items: center;\n  text-align: center;\n  padding: 0 2em 0 0;\n  cursor: pointer;\n}\n\nul.ztr-comment-actions li span {\n  padding: 0.25em 0.25em 0 0.25em;\n  color: var(--ztr-icon-color, #3b3b3b);\n}\n\nsvg {\n  fill: var(--ztr-icon-color, #3b3b3b);\n  width: 1.1em;\n  height: 1.1em;\n}\n\n.ztr-comment-action-reply:hover svg {\n  fill: #92379c;\n}\n\n.ztr-comment-action-reply:hover span {\n  color: #92379c;\n}\n\n.ztr-comment-action-zap:hover svg {\n  fill: #e4984d;\n}\n\n.ztr-comment-action-zap:hover span {\n  color: #e4984d;\n}\n\n.ztr-comment-action-like:hover svg {\n  fill: #e35428;\n}\n\n.ztr-comment-action-like:hover span {\n  color: #e35428;\n}\n\n.ztr-reply-form {\n  padding: 0 0.5em 0 3.5em;\n}\n\n.ztr-reply-form textarea {\n  font-family: var(--ztr-font);\n  font-size: 1.1em;\n  line-height: 1.4;\n  /* color: #2B2B2B; */\n  /* background-color: #FDFDFD; */\n  color: var(--ztr-text-color);\n  background-color: var(--ztr-background-color, rgba(0, 0, 0, 0.03));\n  border: 1px solid #bbb;\n  outline: none;\n  width: calc(100% - 1.5em);\n  padding: 0.7em;\n  margin: 0.5em 0;\n  height: 4em;\n  border-radius: 0.2em;\n  min-height: 4em;\n  resize: vertical;\n}\n\n.ztr-reply-form input {\n  font-family: var(--ztr-font);\n  font-size: 1.1em;\n  line-height: 1.4;\n  /* color: #2B2B2B;\n  background-color: #FDFDFD; */\n  color: var(--ztr-text-color);\n  background-color: var(--ztr-background-color, rgba(0, 0, 0, 0.03));\n  border: 1px solid #bbb;\n  outline: none;\n  width: calc(100% - 1.5em);\n  padding: 0.7em;\n  margin: 0.5em 0;\n  border-radius: 0.2em;\n  resize: vertical;\n}\n\n.ztr-reply-form:disabled {\n  opacity: 65%;\n  user-select: none;\n}\n\n.ztr-reply-controls {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n}\n\n.ztr-reply-controls span {\n  font-weight: bold;\n  font-size: 0.85em;\n  margin-right: 1em;\n  user-select: none;\n  cursor: default;\n}\n\n.ztr-reply-error {\n  color: rgb(202, 23, 23);\n}\n\n.ztr-reply-controls button {\n  font-family: var(--ztr-font);\n  appearance: none;\n  border: none;\n  padding: 0.5em 1em;\n  border-radius: 0.2em;\n  font-size: 0.85em;\n  font-weight: 600;\n  cursor: pointer;\n}\n\n.ztr-reply-login-button {\n  color: white;\n  background-color: var(--ztr-login-button-color, #2b2b2b);\n  margin-left: 1em;\n}\n\n.ztr-reply-count-button {\n  font-family: var(--ztr-font);\n  appearance: none;\n  border: none;\n  padding: 0.5em 1em;\n  border-radius: 0.2em;\n  font-size: 0.85em;\n  font-weight: 600;\n  cursor: pointer;\n  color: white;\n  background-color: var(--ztr-login-button-color, #2b2b2b);\n}\n\n.ztr-reply-button {\n  color: var(--ztr-text-color);\n  display: flex;\n  align-items: center;\n}\n\n.ztr-info-pane {\n  padding: 0 0.5em 1em 3.5em;\n}\n\n.ztr-info-pane pre {\n  font-size: 0.8em;\n}\n\n.ztr-spinner {\n  width: 1.2em;\n  height: 1.2em;\n  padding: 0.9em;\n  animation: rotate 4s linear infinite;\n}\n\n.ztr-reply-button:disabled {\n  opacity: 65%;\n  pointer-events: none;\n  cursor: pointer;\n  user-select: none;\n}\n\n.ztr-spinner .path {\n  stroke: var(--ztr-text-color, #2b2b2b);\n  stroke-linecap: round;\n  animation: dash 1.5s ease-in-out infinite;\n}\n\n@keyframes rotate {\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes dash {\n  0% {\n    stroke-dasharray: 1, 150;\n    stroke-dashoffset: 0;\n  }\n\n  50% {\n    stroke-dasharray: 90, 150;\n    stroke-dashoffset: -35;\n  }\n\n  100% {\n    stroke-dasharray: 90, 150;\n    stroke-dashoffset: -124;\n  }\n}\n\n/* new */\n\n.ztr-comment-new .ztr-reply-form {\n  margin: 0.5em 0;\n  padding: 0;\n}\n\n.ztr-comment-new .ztr-comment-body {\n  padding: 0;\n}\n\n.ztr-comment-new .ztr-comment-actions {\n  font-size: 1.1em;\n  padding: 0;\n}\n\n/* Dark mode defaults */\n\n@media (prefers-color-scheme: dark) {\n  .ztr-spinner .path {\n    stroke: var(--ztr-text-color, #dedede);\n  }\n\n  .ztr-comment,\n  .ztr-reply-button {\n    background-color: var(--ztr-background-color, rgba(255, 255, 255, 0.06));\n  }\n\n  .ztr-reply-login-button {\n    color: #2b2b2b;\n    background-color: var(--ztr-login-button-color, #dedede);\n  }\n\n  svg {\n    fill: var(--ztr-icon-color, #dedede);\n  }\n\n  ul.ztr-comment-actions li span {\n    color: var(--ztr-icon-color);\n  }\n\n  .ztr-comment-action-reply:hover svg {\n    fill: #96609c;\n  }\n\n  .ztr-comment-action-reply:hover span {\n    color: #96609c;\n  }\n}\n\n.p-0 {\n  padding: 0 !important;\n}\n\n.mb-1 {\n  margin-bottom: 1em !important;\n}\n\n.mt-1 {\n  margin-top: 1em !important;\n}\n\n@media screen and (max-width: 900px) {\n  .ztr-action-commented {\n    display: none;\n  }\n}\n\n.footer-editor {\n  padding: 1em;\n}\n\n.footer-editor .ztr-reply-form {\n  padding: 0;\n}\n\n@media screen and (max-width: 416px) {\n  .ztr-comment-text,\n  .ztr-comment-actions {\n    padding: 0 !important;\n  }\n\n  .ztr-comment-picture-wrap {\n    padding-left: 0;\n  }\n}\n\n.ztr-reply-message {\n  margin-top: 10px;\n  display: flex;\n  gap: 5px;\n  font-size: 15px;\n  cursor: pointer;\n}\n\n.ztr-reply-button--cancel {\n  background-color: #2b2b2b;\n  color: #dedede;\n  margin-right: 10px;\n}\n\n.ztr-comment--message {\n  padding: 15px;\n  padding-right: 50px;\n}\n\n.ztr-comment--author {\n  padding-left: 50px;\n  padding-right: 15px;\n}\n\n.ztr-comment-body--message {\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);\n  border-radius: 10px;\n  max-width: 700px;\n}\n\n.ztr-comment-body--author {\n  margin-left: auto;\n}\n\n.ztr-root-comment-editor--message {\n  position: sticky;\n  bottom: 0;\n  background-color: #fff;\n  padding: 0 15px;\n}\n\n.ztr-root--message {\n  overflow: hidden;\n  height: 100%;\n  margin: 0 !important;\n}\n\n.ztr-comment-text--message, .ztr-comment-text--message p {\n  margin: 0;\n}\n\n"),te(R,(B=x((()=>!!A())),()=>{return B()&&(e=od(),v((()=>e.innerHTML=A())),e);var e}),null),te(R,($=x((()=>"error"===i().type)),()=>{return $()&&[id(),(e=sd(),te(e.firstChild,(()=>i().value)),e)];var e}),null),te(R,(P=x((()=>"error"!==i().type)),()=>{return P()&&[!c&&x((()=>x((()=>!o.disableFeatures.includes("reply")))()&&F(kc,{pool:r,store:o,handleExitThread:!0}))),!c&&(i=ad(),te(i,(n=x((()=>C()>0)),()=>n()&&`${C()} comment${1==C()?"":"s"}`)),i),l?F(Gu,{pool:r,store:o,child:!1,nestedEvents:_,articles:k}):F(Zc,{pool:r,store:o,nestedEvents:_,articles:k}),c&&(t=ld(),Q(t,L),te(t,(e=x((()=>!o.disableFeatures.includes("reply"))),()=>e()&&F(kc,{pool:r,store:o,handleExitThread:!0}))),t)];var e,t,n,i}),null),R;var B,$,P,R,U};return function(e,t,n){2===arguments.length&&(n=t,t={}),fe(e,t)(pe(n))}("zap-threads",{anchor:"",version:"",mode:"",npubpro:"",relays:"",user:"",author:"",disable:"",urls:"","reply-placeholder":"","legacy-url":""},(e=>F(cd,{get anchor(){return e.anchor??""},get version(){return e.version??""},get mode(){return e.mode??""},get npubPro(){return e.npubpro??""},get relays(){return e.relays??""},get user(){return e.user??""},get author(){return e.author??""},get disable(){return e.disable??""},get urls(){return e.urls??""},get replyPlaceholder(){return e["reply-placeholder"]??""},get legacyUrl(){return e["legacy-url"]??""}}))),cd}();
